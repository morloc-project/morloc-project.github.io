<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Morloc Technical Manual</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Morloc Technical Manual</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_is_morloc">1. What is <code>morloc</code>?</a></li>
<li><a href="#_getting_started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_hello_world">2.1. Hello world!</a></li>
<li><a href="#_single_langage_function_composition">2.2. Single langage function composition</a></li>
<li><a href="#_composition_between_languages">2.3. Composition between languages</a></li>
</ul>
</li>
<li><a href="#_syntax_and_features">3. Syntax and Features</a>
<ul class="sectlevel2">
<li><a href="#_primitives_and_containers">3.1. Primitives and containers</a></li>
<li><a href="#_semicolons_and_whitespace">3.2. Semicolons and whitespace</a></li>
<li><a href="#_functions">3.3. Functions</a></li>
<li><a href="#_type_signatures">3.4. Type signatures</a></li>
<li><a href="#_sourcing_functions">3.5. Sourcing functions</a></li>
<li><a href="#_type_defaults">3.6. Type defaults</a></li>
<li><a href="#_type_aliases">3.7. Type aliases</a></li>
<li><a href="#_records_objects_and_tables">3.8. Records, objects, and tables</a></li>
<li><a href="#_modules">3.9. Modules</a></li>
<li><a href="#_core_libraries">3.10. Core libraries</a></li>
</ul>
</li>
<li><a href="#_code_generation_and_optimization">4. Code Generation and Optimization</a>
<ul class="sectlevel2">
<li><a href="#_rewrite">4.1. Rewrite</a></li>
<li><a href="#_realize">4.2. Realize</a></li>
<li><a href="#_optimization">4.3. Optimization</a></li>
<li><a href="#_serialization">4.4. Serialization</a></li>
</ul>
</li>
<li><a href="#_specification">5. Specification</a>
<ul class="sectlevel2">
<li><a href="#_grammar">5.1. Grammar</a></li>
<li><a href="#_declarative_type_system">5.2. Declarative type system</a></li>
<li><a href="#_algorithmic_rules">5.3. Algorithmic Rules</a></li>
<li><a href="#_let_polymorphism">5.4. Let polymorphism</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="stemblock">
<div class="content">
\[
\def\ea{\widehat{\alpha}}
\def\eb{\widehat{\beta}}
\def\eg{\widehat{\gamma}}
\def\sep{ \quad\quad}
\newcommand{\mark}[1]{\blacktriangleright_{#1}}
\newcommand{\expr}[3]{#1\ \ \vdash\ #2\ \dashv\ \ #3}
\newcommand{\packto}[2]{#1\ \approx &gt;\ #2}
\newcommand{\apply}[3]{#1 \bullet #2\ \Rightarrow {\kern -1em} \Rightarrow\ #3}
\newcommand{\subtype}[2]{#1\ :\leqq\ #2}
\newcommand{\braced}[1]{\lbrace #1 \rbrace}
\]
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_morloc">1. What is <code>morloc</code>?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>morloc</code> is a functional programming language where functions are imported from
foreign languages and unified through a common type system. The compiler
generates the code needed to compose functions across languages and also to
direct automation of mundane tasks such as data validation, type/format
conversions, data caching, distributed computing, and file reading/writing.</p>
</div>
<div class="paragraph">
<p>The ultimate purpose of the Morloc system is to serve as the foundation for a
universal library of functions. Each function in the library has a universal
type that specifies how the function relates to other functions. Each function
has zero or more implementations. Each implementation has a language-specific
type that aligns with the universal type. The Morloc compiler takes the
specification for a program, written as a composition of typed functions, and
generates an optimized program.</p>
</div>
<div class="paragraph">
<p>Morloc is a query language that takes a program specification and searches
against a function database, returning an optimized composition of functions.
The functions may be selected all from one language or from several.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">2. Getting Started</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>export hello
hello = &quot;Hello world!!!&quot;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_hello_world">2.1. Hello world!</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>export hello
hello = &quot;Hello World&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "export" keyword exports the variable "hello" from the module.</p>
</div>
<div class="paragraph">
<p>Paste this into a file (e.g. "hello.loc") and then it can be imported by other
<code>morloc</code> modules or directly compiled into a program where every exported term
is a subcommand.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>morloc make hello.loc</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate a single file named "nexus.pl". The nexus is the executable
script that the user will interact with. For this simple example, it is the
only generated file. It is currently written in Perl.</p>
</div>
<div class="paragraph">
<p>Calling "nexus.pl" with no arguemtns or with the <code>-h</code> flag, will print a help
message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>$ ./nexus.pl -h
The following commands are exported:
  hello [0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>[0]</code> states the number of arguments the "command" hello takes.</p>
</div>
<div class="paragraph">
<p>The command is called as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>$ ./nexus.pl hello
Hello World</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_single_langage_function_composition">2.2. Single langage function composition</h3>
<div class="paragraph">
<p>The following code uses only C++ functions (<code>fold</code>, <code>map</code>, <code>add</code> and <code>mul</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>import cppbase (fold, map, add, mul)

export square;
export sumOfSquares;

square x = mul x x;

sumOfSquares xs = fold add 0 (map square xs);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this script is pasted into the file "example-1.loc", it can be compiled as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>morloc install cppbase
morloc make example-1.loc</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>install</code> command clones the <code>cppbase</code> repo from github into the
local directory <code>~/.morloc/lib</code>. The <code>make</code> command will generate a file named
<code>nexus.pl</code>, which is an executable interface to the exported functions.</p>
</div>
<div class="paragraph">
<p>You can see the exported functions and the number of arguments they take:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>$ ./nexus.pl
The following commands are exported
  square <span class="tok-o">[</span><span class="tok-m">1</span><span class="tok-o">]</span>
  rms <span class="tok-o">[</span><span class="tok-m">1</span><span class="tok-o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call the exported functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span>$ ./nexus.pl sumOfSquares <span class="tok-o">[</span><span class="tok-m">1</span>,2,3<span class="tok-o">]</span>
<span class="tok-m">14</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>nexus.pl</code> executable dispatches the command to the compiled C++ program, <code>pool-cpp.out</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_composition_between_languages">2.3. Composition between languages</h3>
<div class="paragraph">
<p><code>morloc</code> can compose functions across languages. For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>import math (fibonacci);
import rbase (plotVectorPDF, ints2reals);

export fibplot

fibplot n = plotVectorPDF (ints2reals (fibonacci n)) &quot;fibonacci-plot.pdf&quot;;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fibplot</code> function calculates Fibonacci numbers using a C++ function and
plots it using an R function.</p>
</div>
<div class="paragraph">
<p><code>plotVectorPDF</code> is defined in the <code>morloc</code> module <code>rbase</code>. The <code>morloc</code> module
contains the following files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>README.md
package.yaml
main.loc
core.R
rbase.R</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main.loc</code> file contains <code>morloc</code> function signatures, compositions, and
export statements. The <code>core.R</code> and <code>rbase.R</code> files contain R source code.
<code>rbase.R</code> contains the general serialization functions required for R
interoperability with other languages. The <code>core.R</code> file contains mostly core
utilities that are common between languages (<code>map</code>, <code>zip</code>, <code>fold</code>, <code>add</code>,
<code>sub</code>, etc). <code>ints2reals</code> is an alias for the base R function <code>as.numeric</code>.
<code>plotPDF</code> is a wrapper around the generic R plot function, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="R"><span></span>plotVectorPDF &lt;- function(x, filename){
  pdf(filename)
  plot(x)
  dev.off()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a perfectly normal R function with no extra boilerplate. It takes an
arbitrary input <code>x</code> and a filename, passes <code>x</code> to the generic plot function,
and writes the result to a PDF with the name <code>filename</code>.</p>
</div>
<div class="paragraph">
<p>The <code>main.loc</code> file contains the type signatures for this function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>plotVectorPDF :: [Num] -&gt; Str -&gt; ()
plotVectorPDF R :: [numeric] -&gt; character -&gt; ()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first signature is the general type, the second is the concrete, R-specific
type.</p>
</div>
<div class="paragraph">
<p>Similarly the <code>fibonacci</code> <code>C++</code> function has the types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>fibonacci :: Int -&gt; List Int
fibonacci Cpp :: &quot;size_t&quot; -&gt; &quot;std::vector&lt;$1&gt;&quot; size_t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The general type, <code>Int &#8594; List Int</code>, describes a function that takes an integer
and returns a list of integers. <code>List Int</code> could be written equivalently as
<code>[Int]</code>. The concrete type signature <em>aligns</em> to the general one in that it
must be a function of the same number of arguments and any parameterized types
must have the same number of parameters (and so on down recursively into the
type). <code>"std::vector&lt;$1&gt;" size_t</code> aligns to <code>List Int</code> (or equivalently,
<code>[Int]</code>). The type that is used in <code>C++</code> prototypes and type annotations is
generated from the concrete type via macro expansion into the type constructor:
<code>size_t</code> replaces <code>$1</code> yielding the concrete type <code>std::vector&lt;size_t&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The fibonacci function itself is a normal C++ function with the prototype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="C++"><span></span>std::vector&lt;size_t&gt; fibonacci(size_t n);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax_and_features">3. Syntax and Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primitives_and_containers">3.1. Primitives and containers</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>data : True | False
     | number
     | string
     | [data, ...]       -- lists
     | (data, ...)       -- tuples
     | {x = data, ...}   -- records</code></pre>
</div>
</div>
<div class="paragraph">
<p>As for as <code>morloc</code> is concerned, <code>number</code> is of arbitrary length and precision.
Strings are double quoted and support escapes. In the future, I will add
support for string interpolation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_semicolons_and_whitespace">3.2. Semicolons and whitespace</h3>
<div class="paragraph">
<p>Currently, <code>morloc</code> requires semicolons at the ends of expressions. Semicolons
will always be supported in <code>morloc</code>, but I consider them ugly and an
unnecessary syntax error source, so I will eventually remove them (as soon as I
can figure out how to do so in the parser).</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions">3.3. Functions</h3>
<div class="paragraph">
<p>Function definition follows Haskell syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">foo</span> <span class="tok-n">x</span> <span class="tok-ow">=</span> <span class="tok-n">g</span> <span class="tok-p">(</span><span class="tok-n">f</span> <span class="tok-n">x</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I currently have no support for infix operators, but will in the future. Also,
I do not yet support eta reduction.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_signatures">3.4. Type signatures</h3>
<div class="paragraph">
<p>General type declarations roughly follow Haskell syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">take</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span> <span class="tok-ow">-&gt;</span> <span class="tok-kt">List</span> <span class="tok-n">a</span> <span class="tok-ow">-&gt;</span> <span class="tok-kt">List</span> <span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>a</code> is a generic type variable. I support <code>[a]</code> as sugar for <code>List a</code>.</p>
</div>
<div class="paragraph">
<p>Concrete type declarations describe the type of the function in a specific language:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">take</span> <span class="tok-kt">Cpp</span> <span class="tok-ow">::</span> <span class="tok-s">&quot;int&quot;</span> <span class="tok-ow">-&gt;</span> <span class="tok-s">&quot;std::vector&lt;$1&gt;&quot;</span> <span class="tok-n">a</span> <span class="tok-ow">-&gt;</span> <span class="tok-s">&quot;std::vector&lt;$1&gt;&quot;</span> <span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This signature describes a <code>C` function with arguments types `int` and a
`std::vector` storing generic values. The `$1` will be replaced by the `C</code>
type inferred for <code>a</code> when the target <code>C++</code> code is generated. For example,
<code>"std::vector&lt;$1&gt;" int</code> would translate to <code>std::vector&lt;int&gt;</code>.</p>
</div>
<div class="paragraph">
<p>For languages that do not have parameterized types, such as Python, the type
signature for <code>take</code> might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">take</span> <span class="tok-kt">Py</span> <span class="tok-ow">::</span> <span class="tok-s">&quot;int&quot;</span> <span class="tok-ow">-&gt;</span> <span class="tok-s">&quot;list&quot;</span> <span class="tok-n">a</span> <span class="tok-ow">-&gt;</span> <span class="tok-s">&quot;list&quot;</span> <span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>"list" a</code> types would translate to simply <code>list</code> in Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sourcing_functions">3.5. Sourcing functions</h3>
<div class="paragraph">
<p>Sourcing a function from a foreign language is done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">source</span> <span class="tok-kt">Cpp</span> <span class="tok-n">from</span> <span class="tok-s">&quot;foo.h&quot;</span> <span class="tok-p">(</span><span class="tok-s">&quot;mlc_foo&quot;</span> <span class="tok-n">as</span> <span class="tok-n">foo</span><span class="tok-p">)</span>

<span class="tok-nf">foo</span> <span class="tok-ow">::</span> <span class="tok-kt">A</span> <span class="tok-ow">-&gt;</span> <span class="tok-kt">B</span><span class="tok-p">;</span>
<span class="tok-nf">foo</span> <span class="tok-kt">Cpp</span> <span class="tok-ow">::</span> <span class="tok-s">&quot;int&quot;</span> <span class="tok-ow">-&gt;</span> <span class="tok-s">&quot;std::string&quot;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we state that we are importing the function <code>mlc_foo</code> from the <code>C++</code>
source file <code>foo.h</code> and calling it <code>foo</code>. We then give its general and concrete
types.</p>
</div>
<div class="paragraph">
<p>Currently <code>morloc</code> treats language-specific functions as black boxes. The
compiler does not parse the <code>C++</code> code to insure the type the programmer wrote
is correct (this may be possible in the future).</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_defaults">3.6. Type defaults</h3>
<div class="paragraph">
<p><code>morloc</code> stores default primitive and basic container types for each supported
language. In most languages, there is a sensible default type for reals,
integers, bools, lists, tuples, and maybe records. Many languages will not
distinguish between lists and tuples. Some languages have dynamic records
(python and R) and others require the generation of type definitions (C and
Haskell). These defaults simplify type definitions, allowing use to write `[a]`
in place of the `C` type <code>"std::vector&lt;$1&gt;" a</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_aliases">3.7. Type aliases</h3>
<div class="paragraph">
<p><code>morloc</code> supports type aliases as a syntactic sugar that disapears before the
typechecking step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">type</span> <span class="tok-p">(</span><span class="tok-kt">Pairlist</span> <span class="tok-n">a</span> <span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-p">[(</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-n">b</span><span class="tok-p">)]</span>
<span class="tok-kr">type</span> <span class="tok-kt">Cpp</span> <span class="tok-p">(</span><span class="tok-kt">Pairlist</span> <span class="tok-n">a</span> <span class="tok-n">b</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-p">[(</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-n">b</span><span class="tok-p">)]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_records_objects_and_tables">3.8. Records, objects, and tables</h3>
<div class="paragraph">
<p><code>records</code>, <code>objects</code> and <code>tables</code> are all defined with the same syntax (for
now) but have subtly different meanings.</p>
</div>
<div class="paragraph">
<p>A <code>record</code> is a named, heterogenous list such as a <code>struct</code> in C, a <code>dict</code> in
Python, or a <code>list</code> in R. The type of the record exactly describes the data
stored in the record (in contrast to parameterized types like <code>[a]</code> or <code>Map a b</code>).</p>
</div>
<div class="paragraph">
<p>A <code>table</code> is like a record where all types are replaced by lists of that type.
But <code>table</code> is not just syntactic sugar for a record of lists, the <code>table</code>
annotation is passed with the record through the compiler all the way to the
translator, where the language-specific serialization functions may have
special handling for tables.</p>
</div>
<div class="paragraph">
<p>An <code>object</code> is a record with baggage. It is a special case of an OOP class
where all arguments passed to the constructor can be accessed as public fields.</p>
</div>
<div class="paragraph">
<p>All three are defined in similar ways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">record</span> <span class="tok-p">(</span><span class="tok-kt">PersonRec</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-kt">PersonRec</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>
<span class="tok-nf">record</span> <span class="tok-kt">Cpp</span> <span class="tok-p">(</span><span class="tok-kt">PersonRec</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-s">&quot;MyObj&quot;</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>

<span class="tok-nf">table</span> <span class="tok-p">(</span><span class="tok-kt">PersonTbl</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-kt">PersonObj</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>
<span class="tok-nf">table</span> <span class="tok-kt">R</span> <span class="tok-p">(</span><span class="tok-kt">PersonTbl</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-s">&quot;data.frame&quot;</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>
<span class="tok-nf">table</span> <span class="tok-kt">Cpp</span> <span class="tok-p">(</span><span class="tok-kt">PersonTbl</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-s">&quot;struct&quot;</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>

<span class="tok-nf">record</span> <span class="tok-p">(</span><span class="tok-kt">PersonRec</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-kt">PersonRec</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span>
<span class="tok-nf">object</span> <span class="tok-kt">Cpp</span> <span class="tok-p">(</span><span class="tok-kt">PersonRec</span> <span class="tok-n">a</span><span class="tok-p">)</span> <span class="tok-ow">=</span> <span class="tok-s">&quot;MyObj&quot;</span> <span class="tok-p">{</span><span class="tok-n">name</span> <span class="tok-ow">::</span> <span class="tok-kt">Str</span><span class="tok-p">,</span> <span class="tok-n">age</span> <span class="tok-ow">::</span> <span class="tok-kt">Int</span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>object</code> is undefined for general types, since they don&#8217;t check
luggage. Also note the difference between the type constructor (e.g.
<code>PersonRec</code>) and the data constructor (e.g., <code>"MyObj"</code>). The latter corresponds
to the class constructor in the OOP language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modules">3.9. Modules</h3>
<div class="paragraph">
<p>A module is defined as <code>module Foo { &#8230;&#8203; }</code>. It can be imported with the
<code>import</code> command.</p>
</div>
<div class="paragraph">
<p>The following module defines the constant <code>x</code> and exports it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">module</span> <span class="tok-nn">Foo</span> <span class="tok-p">{</span>
  <span class="tok-n">x</span> <span class="tok-ow">=</span> <span class="tok-mi">42</span><span class="tok-p">;</span>
  <span class="tok-n">export</span> <span class="tok-n">x</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another module can import <code>Foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>import Foo (x)

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A term may be imported from multiple modules. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">module</span> <span class="tok-nn">Add</span> <span class="tok-p">{</span>
<span class="tok-kr">import</span> <span class="tok-nn">cppbase</span> <span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span> <span class="tok-nn">pybase</span> <span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span> <span class="tok-nn">rbase</span> <span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>

<span class="tok-nf">export</span> <span class="tok-n">add</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This module imports that <code>C++</code>, Python, and R <code>add</code> functions and exports all
of them. Modules that import <code>add</code> will import three different versions of the
function. The compiler will choose which to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_core_libraries">3.10. Core libraries</h3>
<div class="paragraph">
<p>Each new language will have a base library that rougly corresponds to the
Haskell prelude. They will have functions for mapping over lists, working with
strings, etc. They will also contain standard type aliases for each language.
For example, <code>type Cpp Int = "std::string"</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_code_generation_and_optimization">4. Code Generation and Optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The input to the code generator is a list of bipartite, ambiguous, abstract
syntax trees (AST). There is one tree for each command exported from the root
module. The AST is implemented as a pair of mutually recursive data structures:
<code>SAnno</code> and <code>SExpr</code>.</p>
</div>
<div class="paragraph">
<p><code>SAnno</code> associates a set of subtrees with a shared annotation (general type and metadata).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">data</span> <span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span> <span class="tok-ow">=</span> <span class="tok-kt">SAnno</span> <span class="tok-p">(</span><span class="tok-n">f</span> <span class="tok-p">(</span><span class="tok-kt">SExpr</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">,</span> <span class="tok-n">c</span><span class="tok-p">))</span> <span class="tok-n">g</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where
 * g - an annotation for the group of child trees (what they have in common)
 * f - a collection type (e.g., <code>One</code> or <code>Many</code>)
 * c - an annotation for the specific child tree</p>
</div>
<div class="paragraph">
<p><code>SExpr</code> represents an expression that may have <code>SAnno</code> children.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">data</span> <span class="tok-kt">SExpr</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span>
  <span class="tok-ow">=</span> <span class="tok-kt">UniS</span>
  <span class="tok-o">|</span> <span class="tok-kt">VarS</span> <span class="tok-kt">EVar</span>
  <span class="tok-o">|</span> <span class="tok-kt">AccS</span> <span class="tok-p">(</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-kt">EVar</span>
  <span class="tok-o">|</span> <span class="tok-kt">ListS</span> <span class="tok-p">[</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">]</span>
  <span class="tok-o">|</span> <span class="tok-kt">TupleS</span> <span class="tok-p">[</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">]</span>
  <span class="tok-o">|</span> <span class="tok-kt">LamS</span> <span class="tok-p">[</span><span class="tok-kt">EVar</span><span class="tok-p">]</span> <span class="tok-p">(</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">)</span>
  <span class="tok-o">|</span> <span class="tok-kt">AppS</span> <span class="tok-p">(</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">)</span> <span class="tok-p">[</span><span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">]</span>
  <span class="tok-o">|</span> <span class="tok-kt">NumS</span> <span class="tok-kt">Scientific</span>
  <span class="tok-o">|</span> <span class="tok-kt">LogS</span> <span class="tok-kt">Bool</span>
  <span class="tok-o">|</span> <span class="tok-kt">StrS</span> <span class="tok-kt">Text</span>
  <span class="tok-o">|</span> <span class="tok-kt">RecS</span> <span class="tok-p">[(</span><span class="tok-kt">EVar</span><span class="tok-p">,</span> <span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-n">f</span> <span class="tok-n">c</span><span class="tok-p">)]</span>
  <span class="tok-o">|</span> <span class="tok-kt">CallS</span> <span class="tok-kt">Source</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_rewrite">4.1. Rewrite</h3>
<div class="paragraph">
<p>The <code>SAnno`s are not quite ready for translation yet. They contain `morloc</code>
functions on the right-hand-side of equations. Yet these functions are not
"real" and should not appear (except as debugging info) in the final generated
code.</p>
</div>
<div class="paragraph">
<p>For example, consider the following <code>morloc</code> script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import cppbase (mul, add)

export foo

foo x y = bar x (baz y)
bar x y = mul x (add y 1)
baz x = mul x x</pre>
</div>
</div>
<div class="paragraph">
<p>The Rewrite step redefines the exported <code>foo</code> function by eliminating the <code>bar</code>
and <code>baz</code> abstractions, as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo x y = mul x (add (mul y y) 1)</pre>
</div>
</div>
<div class="paragraph">
<p>The process is complicated when there are unresolved topology differences. For
example, if <code>bar</code> has two definitions, as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import cppbase (mul, add, bar)

export foo

foo x y = bar x (baz y)
bar x y = mul x (add y 1)
baz x = mul x x</pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>bar</code> can either be the <code>morloc</code> abstraction or the <code>C++</code> function. So we
can generate two possible forms of <code>foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo x y = mul x (add (mul y y) 1)
foo x y = bar x (mul y y)</pre>
</div>
</div>
<div class="paragraph">
<p>These two ASTs will be included under the <code>Many</code> in the <code>SAnno</code> output.</p>
</div>
</div>
<div class="sect2">
<h3 id="_realize">4.2. Realize</h3>
<div class="paragraph">
<p>The <code>f</code> in the <code>SAnno</code> type takes on two forms in the generator: <code>One</code> or <code>Many</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-kr">data</span> <span class="tok-kt">One</span> <span class="tok-n">a</span> <span class="tok-ow">=</span> <span class="tok-kt">One</span> <span class="tok-n">a</span>
<span class="tok-kr">data</span> <span class="tok-kt">Many</span> <span class="tok-n">a</span> <span class="tok-ow">=</span> <span class="tok-kt">Many</span> <span class="tok-p">[</span><span class="tok-n">a</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The input to the generator is ambiguous, hence <code>f</code> is <code>Many</code>. The "Realize"
step collapses the tree done to a single "realization" (or "instance"). Thus
the <code>realize</code> function, eliding implementation details, has the type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="haskell"><span></span><span class="tok-nf">realize</span> <span class="tok-ow">::</span> <span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-kt">Many</span> <span class="tok-p">[</span><span class="tok-kt">Type</span><span class="tok-p">]</span> <span class="tok-ow">-&gt;</span> <span class="tok-kt">SAnno</span> <span class="tok-n">g</span> <span class="tok-kt">One</span> <span class="tok-kt">Type</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Two levels of ambiguity are removed in this step. The <code>Many</code> to <code>One</code>
transition selects selects a single sub-tree topology. For example, suppose there</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>import math (sum, div, length, mean)
source R (&quot;mean&quot;)

export mean
mean xs = div (sum xs) (length xs)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have three definitions of <code>mean</code>. One is sourced from the <code>R</code> language
(where it is a built in function). One is sourced from the <code>morloc math</code>
module, where it is implemented in C. One is defined as a <code>morloc</code> composition of
the three functions <code>div</code>, <code>sum</code>, and <code>length</code>; these are all implemented in C
currently, but they could gain more implementations in the future.</p>
</div>
<div class="paragraph">
<p>There are <strong>three</strong> definitions of <code>mean</code>, and <strong>two</strong> topologies (thus two
elements in <code>Many</code>). The topologies are either the <code>(div (sum xs) (length xs))</code>
tree or the call to the <code>R</code> or <code>C</code> functions. The first problem is the
<code>Many&#8594;One</code> selection. The second problem is the <code>[Type]&#8594;Type</code> problem, where
the sourced implementation is chosen. Here we decide just between a single <code>R</code>
and single <code>C</code> function. But the choice could be more involved, such as
choosing between a dozen sort algorithms all written in <code>C</code>.</p>
</div>
<div class="paragraph">
<p>This is the data structure is the starting point for an epic optimization
problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_optimization">4.3. Optimization</h3>
<div class="paragraph">
<div class="title">Algorithm optimization</div>
<p>In the future, when <code>morloc</code> is mature, the realization step will incorporate
community knowledge, performance modeling, and benchmarking to make the optimal
decision. For now, I assign a relative cost to each pair of inter-language
calls and find the tree that minimizes the total cost.</p>
</div>
<div class="paragraph">
<p>The most interesting optimizations involve choices between algorithms. We could
build formal performance models for each algorithm and parameterize them
empirically for each implementation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>performance</p>
</li>
<li>
<p>accuracy</p>
</li>
<li>
<p>parameterization</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Build optimization</div>
<p>The goal of build optimization is to 1) ensure the program compiles, 2)
minimize the dependencies and 3) tailor the build to the local architecture. In
theory, a <code>morloc</code> program can avoid bit-rot and adapt to any architecture so
long as there exists at least one valid tree instance.</p>
</div>
<div class="paragraph">
<p>I haven&#8217;t worked on build optimization yet, but I imagine the input to the
mature <code>morloc</code> build machine will be a description of the local architecture and
a list of possible ASTs, ordered by expected performance. The machine could
then try to build the "best" tree. If the build fails, the machine then finds
the next highest scoring tree that does not contain the failing component.</p>
</div>
<div class="paragraph">
<p>Making this process efficient through judicious use of deep knowledge gathered
from the community will be a major focus in the future. The knowledge gained in
one build (e.g., function X failed on OS Y in state Z) could be uploaded
automatically to the community knowledgebase and accessed in future builds.</p>
</div>
<div class="paragraph">
<div class="title">Interoperability optimization</div>
<p>The minimization of inter-operability costs is the easiest optimization and the
only one that is currently supported. Program performance can be optimized by
reducing the number and cost of foreign calls.</p>
</div>
<div class="listingblock">
<div class="title">Penalties for calls between languages</div>
<div class="content">
<pre>          C    Python           R
C         1       100        1000
Python   10         2        1000
R        10       100           3</pre>
</div>
</div>
<div class="paragraph">
<p>The values in the table above are obviously very rough, but they demonstrate
important principles for optimizing <code>morloc</code> programs. Calls within languages are
cheap and between languages are expensive. Major performance improvements could
be obtained by removing the start-up costs of loading the R/Python runtime
(e.g., passing data to an open R server rather than restarting R for every
call).</p>
</div>
</div>
<div class="sect2">
<h3 id="_serialization">4.4. Serialization</h3>
<div class="paragraph">
<p>The current interoperability paradigm <code>morloc</code> follows under the hood is based
entirely on serialization. To be clear, serialization is not a fundamental
requirement of <code>morloc</code>. JSON serialization could be replaced with
machine-level interoperability for a pair of languages. This change would be
invisible to <code>morloc</code> programmers, since serialization interop is handled by
the compiler.</p>
</div>
<div class="paragraph">
<p>Data types that have an unambiguous mapping to the JSON data model can be
automatically serialized without special handling added by the programmer. The
JSON data model follows this grammar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>json : number
     | bool
     | string
     | null
     | [json]
     | {label : json, ...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types that are compositions of primitives and containers can be automatically
serialized. This includes records and the subset of objects for which arguments
passed to the constructor are asigned to accessible fields. For other types, an
(un)packing function that simplifies the data is required. For example, take
the general type <code>Map a b</code>, which maps keys of type <code>a</code> to values of type <code>b</code>.
In a given language, the <code>Map</code> type may be implemented as a hash table, a tree,
pair lists, or even a connection to a database. The types <code>a</code> and <code>b</code> do not
give enough information to serialize the object. Therefore, the user must
provide an unpack function which could be <code>Map a b &#8594; ([a],[b])</code> or perhaps
<code>Map a b &#8594; [(a,b)]</code> while the pack function work in the opposite direction.
See below for the <code>morloc</code> code required to add support for <code>Map</code> to <code>C++</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>source Cpp &quot;map-packing.hpp&quot; (&quot;unpack_map&quot;, &quot;pack_map&quot;)

unpack_map :: Map a b -&gt; ([a],[b])
unpack_map Cpp :: &quot;std::map&lt;$1,$2&gt;&quot; a b -&gt; ([a],[b])

pack_map :: ([a],[b]) -&gt; Map a b
pack_map Cpp :: ([a],[b]) -&gt; &quot;std::map&lt;$1,$2&gt;&quot; a b</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the unpack function <code>Map a b &#8594; ([a],[b])</code> does not necessarily take
us all the way to a serializable form since <code>a</code> and <code>b</code> may be arbitrarily
complex objects. This is no problem, <code>morloc</code> will recursively handle
(de)serialization all the way down.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specification">5. Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>This section is a work in progress</strong></p>
</div>
<div class="paragraph">
<p>The type system presented within this section is based the work of Dunfield and
Krishnaswami [<a href="#dunfield2013complete">1</a>]. I preserved their naming conventions
where possible. Only the basic type checking and inference (System F) is
described here, the broader knowledge system introduced in the prior section
has not yet been implemented.</p>
</div>
<div class="sect2">
<h3 id="_grammar">5.1. Grammar</h3>
<div class="stemblock">
<div class="content">
\[
\begin{align}
program   &amp;\ :\ [statement]                         \sep &amp; \text{brackets indicate a list of 0 or more} \\
statement &amp;\ :\ \text{Source}\ x\ L                 \sep &amp; \text{source var x from language L} \\
{}        &amp;\ |\ \text{Import}\ v\ L                 \sep &amp; \text{import all terms in module v} \\
{}        &amp;\ |\ \text{Export}\ x                    \sep &amp; \text{export var x from this module} \\
{}        &amp;\ |\ x\ L ::\ A_L                        \sep &amp; \text{signature for language L} \\
{}        &amp;\ |\ x=expr\                             \sep &amp; \text{declaration} \\
expr      &amp;\ :\ (\ )                                \sep &amp; \text{nothing} \\
{}        &amp;\ |\ x                                   \sep &amp; \text{a variable name} \\
{}        &amp;\ |\ x\ ::\ [A_L]                        \sep &amp; \text{annotation, only required for top-level expressions} \\
{}        &amp;\ |\ \lambda x .\ expr                   \sep &amp; \text{abstraction} \\
{}        &amp;\ |\ expr\ expr                          \sep &amp; \text{application} \\
{}        &amp;\ |\ num\ |\ str\ |\ bool                \sep &amp; \text{primitives} \\
{}        &amp;\ |\ [e_1, ..., e_n]                     \sep &amp; \text{list} \\
{}        &amp;\ |\ (e_1, ..., e_n)                     \sep &amp; \text{tuple} \\
{}        &amp;\ |\ \braced{v_1=e_1,\ ...,\ v_n = e_n}  \sep &amp; \text{record}
\end{align}
\]
</div>
</div>
<div class="paragraph">
<p>This system departs from conventional lambda calculus by supporting multiple
languages in one program. It is designed to typecheck programs comprised of
many languages that share a common general type but that also have
language-specific, concrete types. Thus an expression may have the abstract
type <code>Num</code>, the C-type <code>double</code> and the python type <code>float</code>. Top-level
signatures can be used to specify the type of a term in different languages. A
term may be sourced from many different languages, thus \(x\) is
multilingual.</p>
</div>
<div class="stemblock">
<div class="content">
\[
\begin{align}
\text{Types} \sep A,B,C\
       &amp;: \alpha_L   \sep &amp; \text{var in language L} \\
       &amp;|\ A \rightarrow B              \sep &amp; \text{function} \\
       &amp;|\ \forall\ \alpha_L\ . A       \sep &amp; \text{universal quantification over L} \\
       &amp;|\ \alpha_L\ [A]                \sep &amp; \text{parameterization} \\
       &amp;|\ \ea_L [A] [d]       \sep &amp; \text{existential (unsolved) variable with parameters and defaults}
\end{align}
\]
</div>
</div>
<div class="paragraph">
<p>Every type is associated with either the general language or a concrete
realization of the general type into a specific language.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\text{TypeAnnotation} \sep A^{\bullet}, B^{\bullet}, C^{\bullet}\ := A \; L \; \braced{P_i}_{i=0}^m \; \braced{C_i}_{i=0}^n\)
  <br>
   \(\text{Typeset} \sep \vec{A} := A_1^{\bullet},\ ...,\ A_n^{\bullet}\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A type annotation couples a type in a given language with a set of properties
and constraints. The "properties" of the type are a set of n-ary relations
describing the type. These properties will eventually be used to implement the
equivalent of Haskell typeclasses. In the near future, I will add support for
casting functions that can be defined to allow automatic, language-specific,
handling for conversions between types (e.g., handling automatic conversions
from integers to doubles). The "constraints" are not yet implemented, but will
be a list of assertions that must be met. When possible, these constraints will
be evaluated statically, otherwise they will be translated into (possibly
optional) runtime assertions.</p>
</div>
<div class="paragraph">
<p>Typesets serve as collections of all that is known about a type as it is
represented across languages. Different languages may have different sets of
properties and constraints, they are unified only by a common name and complete
interchangeability.</p>
</div>
</div>
<div class="sect2">
<h3 id="_declarative_type_system">5.2. Declarative type system</h3>
<div class="paragraph">
<p><strong>Coming soon (or late)</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_algorithmic_rules">5.3. Algorithmic Rules</h3>
<div class="stemblock">
<div class="content">
\[
\begin{align}
\Gamma, \Delta &amp; \ :\ [entry]              \sep &amp; \text{ordered list of }entry \text{ items} \\
entry          &amp; \ :\ \alpha_L             \sep &amp; \text{type variable from language L} \\
               &amp; \ |\ e = \vec{A}          \sep &amp; \text{annotated expression}          \\
               &amp; \ |\ \ea_L                \sep &amp; \text{existential}                   \\
               &amp; \ |\ \ea_L = t            \sep &amp; \text{solved existential}            \\
               &amp; \ |\ \mark{x}             \sep &amp; \text{a named marker}                \\
               &amp; \ |\ \text{Source}\ v\ L\ \sep &amp; \text{source term from language L}   \\
\end{align}
\]
</div>
</div>
<div class="paragraph">
<p>The context is a list storing type annotations, solved and unsolved existential
variables, markers, and source/export info.</p>
</div>
<div class="paragraph">
<p>The subtyping rules are adapted from [<a href="#dunfield2013complete">1</a>].</p>
</div>
<div class="paragraph">
<p>I fleshed out the type system with containers (lists, tuples, records) and
parameterized types. The main change though is the addition of multi-lingual
support.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Subtyping Rules</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\expr{\Gamma}{A\ &lt;:\ B}{\Delta}\) \(\quad\quad\) Under input context \(\Gamma\), type \(A\) is a subtype of \(B\), with output context \(\Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{}{\expr{\Gamma}{\alpha_L\ &lt;:\ \alpha_L}{\Gamma}}\) <span class="green">&lt;:Var</span>
   \(\quad\quad\)
   \(\frac{\packto{\beta_{L2}}{\alpha_{L1}}}{\expr{\Gamma}{\alpha_{L1}\ &lt;:\ \beta_{L2}}{\Gamma}}\) <span class="blue">&lt;:AlienVar*</span>
  <br>
  <br>
   \(\frac{}{\expr{\Gamma}{\ea_L\ &lt;:\ \ea_L}{\Gamma}}\) <span class="green">&lt;:Exvar</span>
   \(\quad\quad\)
   \(\frac{}{\expr{\Gamma}{\ea_{L1}\ &lt;:\ \eb_{L2}}{\Gamma,\ \packto{\eb_{L2}}{\ea_{L1}}}}\) <span class="blue">&lt;:AlienExvar*</span>
  <br>
  <br>
   \(\frac{\Delta_1 = \Gamma \quad [\expr{\Delta_{i}}{A_i\ &lt;:\ B_i}{\Delta_{i+1}}]_{i=1}^n}{\expr{\Gamma}{\alpha_L\ [A_i]_{i=1}^n &lt;:\ \alpha_L\ [B_i]_{i=1}^n}{\Delta_{n+1}}}\) <span class="blue">&lt;:App</span>
   \(\quad\quad\)
   \(\frac{\Delta_1 = \Gamma \quad [ \expr{\Delta_i}{A_i\ &lt;:\ B_i}{\Delta_{i+1}} ]_{i=1}^n \quad \packto{\beta_{L2}\ [B_i]_{i=1}^m}{\alpha_{L1}\ [A_i]_{i=1}^n}}{\expr{\Gamma}{\alpha_{L1}\ [A_i]_{i=1}^n\ &lt;:\ \beta_{L2}\ [B_i]_{i=1}^n}{\Delta_{n+1}}}\) <span class="blue">&lt;:AppAlien</span>
  <br>
  <br>
   \(\frac{\packto{\alpha_{L1}\ [A_i]_{i=1}^n}{\beta_{L2}}}{\expr{\Gamma}{\alpha_{L1}\ [A_i]_{i=1}^n\ &lt;:\ \beta_{L2}}{\Gamma}}\) <span class="blue">&lt;:AppAlienVarL</span>
   \(\quad\quad\)
   \(\frac{\packto{\alpha_{L1}}{\beta_{L2}\ [B_i]_{i=1}^n}}{\expr{\Gamma}{\alpha_{L1}\ &lt;:\ \beta_{L2}\ [B_i]_{i=1}^n}{\Gamma}}\) <span class="blue">&lt;:AppAlienVarR</span>
  <br>
  <br>
   \(\frac{\expr{\Gamma}{B_1\ &lt;:\ A_1}{\Theta} \quad \expr{\Theta}{[\Theta]A_2\ &lt;:\ [\Theta]B_2}{\Delta}}{\expr{\Gamma}{A_1 \rightarrow A_2\ &lt;:\ B_1 \rightarrow B_2}{\Delta}}\) <span class="green">&lt;:</span>
  <br>
  <br>
   \(\frac{\expr{\Gamma,\mark{\ea_L},\ea_L}{[\ea_L/\alpha_L]A\ &lt;:\ B}{\Delta,\mark{\ea_L},\Theta}}{\expr{\Gamma}{\forall \alpha_L . A\ &lt;:\ B}{\Delta}}\) <span class="green">&lt;:L</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma,\alpha_L}{A&lt;:B}{\Delta,\alpha_L,\Theta}}{\expr{\Gamma}{A &lt;: \forall \alpha_L . B}{\Delta}}\) <span class="green">&lt;:R</span>
  <br>
  <br>
   \(\frac{\ea_L \notin FV(A) \quad \expr{\Gamma[\ea_L]}{\subtype{\ea_L}{A}}{\Delta}}{\expr{\Gamma[\ea_L]}{\ea_L\ &lt;:\ A}{\Delta}}\) <span class="green">&lt;:InstantiateL</span>
   \(\quad\quad\)
   \(\frac{\ea_L \notin FV(A) \quad \expr{\Gamma[\ea_L]}{\subtype{A}{\ea_L}}{\Delta}}{\expr{\Gamma[\ea_L]}{A\ &lt;:\ \ea_L}{\Delta}}\) <span class="green">&lt;:InstantiateR</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{subtype} :: A \rightarrow B \rightarrow \Gamma \rightarrow \Delta\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Type variables in different languages have no subtype relationship. As far as
the typechecker goes, it is assumed that the language-specific (concrete) types
match if the general types do. Note that functions are not annotated with
languages. Thus the subtype test \(A \rightarrow B\ &lt;:\ \alpha_L\) and its reverse
will both raise errors.</p>
</div>
<div class="paragraph">
<p>The rule &lt;:AlienExvar stores in context an "existential assertion" that
cannot be evaluated until the existential variables it contains are solved.</p>
</div>
<div class="paragraph">
<p>Parameterized types across languages is supported. This may seem impossible,
since not all languages support parameterized types. This is easiest to explain
with examples showing general, Haskell, <code>C++</code>, python and R signatures.</p>
</div>
<div class="listingblock">
<div class="title">map of strings to integers</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>x :: Map String Integer
x Haskell :: <span class="tok-s2">&quot;Map </span><span class="tok-nv">$1</span><span class="tok-s2"> </span><span class="tok-nv">$2</span><span class="tok-s2">&quot;</span> String Integer
x C++ :: <span class="tok-s2">&quot;std::map&lt;</span><span class="tok-nv">$1</span><span class="tok-s2">,</span><span class="tok-nv">$2</span><span class="tok-s2">&gt;&quot;</span> <span class="tok-s2">&quot;std::string&quot;</span> int
x Python :: <span class="tok-s2">&quot;dict&quot;</span> str int
x R :: <span class="tok-s2">&quot;list&quot;</span> str int</code></pre>
</div>
</div>
<div class="paragraph">
<p>To allow for different syntax for paramterization across languages, the first
term is a pattern that takes the parameters as arguments. For Haskell and
<code>C++</code>, the parameterized types would ultimately be formed into <code>Map String
Integer</code> and <code>std::map&lt;std::string,int&gt;</code>, respectively. For dynamic languages,
the parameters will not appear in final type itself (<code>dict</code> and <code>list</code>,
respectively), but the type information will be preserved.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Instantiation Rules</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\expr{\Gamma}{\subtype{\ea_L}{A}}{\Delta}\) \(\quad\quad\) Under input context \(\Gamma\), instantiate \(\ea_L\) such that \(\ea_L &lt;: A\), with output context \(\Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{\Gamma\ \vdash\ \tau}{\expr{\Gamma,\ea_L,\Gamma'}{\subtype{\ea_L}{\tau}}{\Gamma,\ea_L=\tau,\Gamma'}}\) <span class="green">InstLSolve</span>
   \(\quad\quad\)
   \(\frac{}{\expr{\Gamma[\ea_L][\eb_L]}{\subtype{\ea_L}{\eb_L}}{\Gamma[\ea_L][\eb=\ea_L]}}\) <span class="green">InstLReach</span>
  <br>
  <br>
   \(\frac{\expr{\Gamma[\ea_2,\ea_1,\ea=\ea_2\rightarrow\ea_1]}{\subtype{A_1}{\ea_1}}{\Theta} \quad \expr{\Theta}{\subtype{\ea_2}{[\Theta]A_2}}{\Delta}}{\expr{\Gamma[\ea]}{\subtype{\ea}{A_1 \rightarrow A_2}}{\Delta}}\) <span class="green">InstLArr</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma[\ea_L],\beta_L}{\subtype{\ea_L}{B}}{\Delta,\beta_L,\Delta'}}{\expr{\Gamma[\ea_L}{\subtype{\ea_L}{\forall \beta_L . B}}{\Delta}}\) <span class="green">InstLAllR</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{\Gamma\ \vdash\ \tau}{\expr{\Gamma,\ea_L,\Gamma'}{\subtype{\tau}{\ea_L}}{\Gamma,\ea_L=\tau,\Gamma'}}\) <span class="green">InstRSolve</span>
   \(\quad\quad\)
   \(\frac{}{\expr{\Gamma[\ea_L][\eb_L]}{\subtype{\eb_L}{\ea_L}}{\Gamma[\ea_L][\eb_L=\ea_L]}}\) <span class="green">InstRReach</span>
  <br>
  <br>
   \(\frac{\expr{\Gamma[\ea_{L,2},\ea_{L,1},\ea_L=\ea_{L,2}\rightarrow\ea_{L,1}]}{\subtype{\ea_{L,1}}{A_1}}{\Theta}  \quad  \expr{\Theta}{\subtype{[\Theta]A_2}{\ea_{L,2}}}{\Delta}}{\expr{\Gamma[\ea_L]}{\subtype{A_1 \rightarrow A_2}{\ea}}{\Delta}}\) <span class="green">InstRArr</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma[\ea_L],\ \blacktriangleright \eb_L,\ \eb_L}{\subtype{[\eb_L/\beta_L]B}{\ea_L}}{\Delta,\ \blacktriangleright \eb_L,\ \Delta'}}{\expr{\Gamma[\ea_L]}{\subtype{\forall \beta_L . B}{\ea_L}}{\Delta}}\) <span class="green">InstRAllL</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{instantiate}\ ::\ A \rightarrow B \rightarrow \Gamma \rightarrow \Delta\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The instantiation rules above are identical to the rules from DK. However, in
<code>morloc</code>, existential types additionally carry parameters and default values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Transform rules</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\packto{A_{L1}}{B_{L2}}\) \(\quad\quad\) Type \(A\) in language \(L1\) can be uniquely transformed to type \(B\) in language \(L2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{}{\expr{\Gamma}{\packto{A_L}{A_L}}{\Gamma}}\) <span class="green">SerializeCis</span>
   \(\quad\quad\)
   \(\frac {f\ L_1\ ::\ \text{packs}\ \Rightarrow\ A'_{L1}\ \rightarrow\ C_{L1} \quad g\ L_2\ ::\ \text{unpacks}\ \Rightarrow\ D_{L2}\ \rightarrow\ B'_{L2} \quad \subtype{A'_{L1}}{A_{L1}} \quad \subtype{B'_{L1}}{B_{L1}}} {\expr{\Gamma}{\packto{A_{L1}}{B_{L2}}}{\Gamma}}\) <span class="green">SerializeTrans</span>
  <br>
  <br>
   \(\frac{f\ L\ ::\ \text{cast}\ \Rightarrow\ A_L\ \rightarrow\ X_L \quad \packto{X_L}{B_L}}{\expr{\Gamma}{\packto{A_{L}}{B_{L}}}{\Gamma}}\) <span class="green">Cast</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{cast}\ ::\ A\ \rightarrow\ B\ \rightarrow\ \Gamma\ \rightarrow\ \Gamma\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The transform rules assert that types are interconvertible. The serialization
rules transform between semantically equivalent types that are expressed in
different languages. The cast rules transform between semantically different
types expressed in the same language.</p>
</div>
<div class="paragraph">
<p>SerializeCis is a trivial rule stating that any type can be converted to
itself. SerializeTrans states that types \(A_{L1}\) and \(A_{L2}\) interconverted
if there exist functions for serializing from type \(A\) in language \(L_1\) to a
standard intermediate form (e.g., JSON) and a derserialization function from
the standard intermediate to \(B\) in language \(L_2\). The serialization function
may be more polymorphic than \(A\) and \(B\). For example, a general serialization
function may exist which would serialiaze any type in the given language into
JSON.</p>
</div>
<div class="paragraph">
<p>These assertions alone are not sufficient for proving that two types are
interconvertible. The serialization functions show only that a path exists
between the types (e.g., they serialize to a common JSON object), it does not
show that the types are semantically equivalent. Semantic equivalence is
demonstrated through typechecking of the general, language-independent, type.
That is, if the language-specific types under consideration are not
semantically equivalent, and error will be raised elsewhere in the typechecking
process.</p>
</div>
<div class="paragraph">
<p>Prior to <code>morloc</code> v0.22.0, I explicitly wrote serialization functions with
<code>morloc</code> signatures using the <code>pack</code>/<code>unpack</code> property. In v0.22.0, I replaced
this system with a language-specific approach of passing some form of
type-template to the serialization machinery particular to the given language.
This means serialization is up to the libraries in the specific languages and
the type checker will not be able to catch the absence of a serialization path.
This approach has worked well, but I am not happy with the absence of static
checks or with how awkward it is to explain.</p>
</div>
<div class="paragraph">
<p>The Cast rule involves handling of directed automatic conversions between
types within a language. A common example of this would be the conversion of
integers to doubles. The current rules are very strict, requiring type identity
for casting, and are not amiable to more general transformations. Note the rule
is recursive. The cast functions form a directed graph (usually highly
disconnected and possibly cyclic) of unambiguous and unfailing transformations
between types. They should describe relationships where there is a single
obvious meaning (e.g., a-&gt;[a] or PositiveInteger-&gt;Integer) and that will
never fail (so string to integer would not be included).</p>
</div>
<div class="paragraph">
<p>Further, the rules specified here are assertions showing the transformations
are possible. There may be multiple paths to accomplishing the transforms that
will differ in performance and require different dependencies at build time.
Choosing which path to take is not the responsibility of the typechecker and
will be dependent on the user&#8217;s system architecture and local configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. synthesize</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\expr{\Gamma}{e \Rightarrow A}{\Delta}\) \(\quad\quad\) Under input context \(\Gamma\), \(e\) synthesizes output type \(A\), with output context \(\Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{\expr{\Gamma, x:A_L}{e_2\ \Rightarrow\ \_}{\Delta}}{\expr{\Gamma}{x\ L\ ::\ A_L\ ;\ e_2}{\Delta}}\) <span class="blue">Signature</span>
   \(\quad\quad\)
   \(\frac{}{\expr{\Gamma}{\text{Source }L\ x}{\Gamma,\ \ea_L}}\) <span class="blue">Source</span>
  <br>
  <br>
   \(\frac{e\ \Rightarrow\ \_\ \vdash\ \Theta \quad \lbrace x:A\ |\ (x:A)\ \in\ \Theta \rbrace\ \vdash\ \Theta' \quad \lbrace x:A\ |\ x\ \in\ xs,\ (x:A) \in \Theta' \rbrace\ \vdash\ \Delta}{\expr{\Gamma}{\text{Import}\ e\ xs}{\Gamma, \Delta}}\) <span class="red">Import</span>
  <br>
  <br>
   \(\frac{x \notin \text{FV}(\Gamma) \quad \expr{\Gamma[x:A], \mark{x}}{e\ \Leftarrow\ A}{\Delta,\mark{x}, \Theta}}{\expr{\Gamma}{x=e}{\Delta}}\) <span class="blue">DeclareCheck</span>
   \(\quad\quad\)
   \(\frac{x \notin \text{FV}(\Gamma) \quad \expr{\Gamma,\mark{x}}{e\ \Rightarrow\ A}{\Delta,\mark{x}, \Theta}}{\expr{\Gamma}{x=e}{\Delta,\ x:\text{Gen}(A)}}\) <span class="blue">DeclareInfer</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{synthesizeToplevel} :: \Gamma \rightarrow e \rightarrow \Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{L = \text{MLang}}{\expr{\Gamma}{\text{number}\ \Rightarrow\ \text{Num}}{\Gamma}}\) <span class="blue">Num</span>
   \(\quad\quad\)
   \(\frac{L = \text{MLang}}{\expr{\Gamma}{\text{int} \Rightarrow \text{Int}}{\Gamma}}\) <span class="blue">Int</span>
   \(\quad\quad\)
   \(\frac{L = \text{MLang}}{\expr{\Gamma}{\text{string} \Rightarrow \text{Str}}{\Gamma}}\) <span class="blue">Str</span>
   \(\quad\quad\)
   \(\frac{L = \text{MLang}}{\expr{\Gamma}{\text{bool} \Rightarrow \text{Bool}}{\Gamma}}\) <span class="blue">Bool</span>
  <br>
  <br>
   \(\frac{L = \text{MLang} \quad \expr{\Gamma}{x_1 \Rightarrow A}{\Delta_1} \quad \expr{\Delta_1}{x_2 \Leftarrow A}{\Delta_2} \quad ... \quad \expr{\Delta_{n-1}}{x_n \Leftarrow A}{\Delta_n}}{\expr{\Gamma}{[x_1,x_2, ..., x_n]}{\Delta_n,\ \text{List}\ A}}\) <span class="blue">List</span>
  <br>
  <br>
   \(\frac{L = \text{MLang} \quad \expr{\Gamma}{x_1 \Rightarrow A_1}{\Delta_1} \quad ... \quad \expr{\Delta_{n-1}}{x_n \Rightarrow A_n}{\Delta_n}}{\expr{\Gamma}{(x_1,x_2,\ ...\ x_n)}{\Delta_n,\ \text{Tuple}\ A_1\ ...\  A_n}}\) <span class="blue">Tuple</span>
  <br>
  <br>
   \(\frac{L = \text{MLang} \quad \expr{\Gamma}{x_1 \Rightarrow A_1}{\Delta_1} \quad ... \quad \expr{\Delta_{n-1}}{x_n \Rightarrow A_n}{\Delta_n}}{\expr{\Gamma}{\lbrace (k_1,x_1),(k_2, x_2),\ ...,\ (k_n, x_n) \rbrace}{\Delta_n,\ \lbrace (k_1, A_1),\ ...,\  (k_n, A_n) \rbrace}}\) <span class="blue">Record</span>
  <br>
  <br>
   \(\frac{L \quad \expr{\Gamma,\ea_L,\eb_L,x:\ea_L}{e \Leftarrow \eb_L}{\Delta, x:\ea_L, \Theta}}{\expr{\Gamma}{\lambda x.e\ \Rightarrow\ \ea_L\rightarrow \eb_L}{\Delta}}\) <span class="green">I</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{synthesizeSingular} :: L \rightarrow \Gamma \rightarrow e \rightarrow (\Delta,\ A)\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{(\,x\,:\,A_L\,)\ \in\ \vec{A}\ \in\ \Gamma}{\expr{\Gamma}{x\ \overset{L}{\Rightarrow} A_L}{\Gamma}}\) <span class="green">Var</span>
   \(\quad\quad\)
   \(\frac{\forall\ M\ .\ (x:A_m)\ \notin\ \vec{A}\ \in\ \Gamma \quad (\,x\,:\,A\,)\ \in\ \vec{A}\ \in\ \Gamma \quad \Gamma\ \vdash\ x=e \quad \expr{\Gamma}{e \overset{L}{\Rightarrow} A_L}{\Delta}}{\expr{\Gamma}{x\ \overset{L}{\Rightarrow} A_L}{\Delta}}\) <span class="blue">Var</span>
  <br>
  <br>
   \(\frac{\Gamma\ \vdash\ A \quad \Delta_1 = \Gamma \quad \braced{ \expr{\Delta_i}{e \overset{L_i}{\Leftarrow} A_i}{\Delta_{i+1}} }_{i=1}^k}{\expr{\Gamma}{(e:\vec{A})\ \Rightarrow\ \vec{A}}{\Delta}}\) <span class="green">Anno</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma}{e_1\ \Rightarrow\ \vec{A}}{\Delta} \quad\quad \braced{ \Delta\ \vdash\ [\Delta] \apply{A_{L_i}}{e_2}{C_{L_i}}\ |\ L_i \in \text{lang}(\vec{A}) }_{i=1}^k}{\expr{\Gamma}{e_1 e_2 \Rightarrow \vec{C}}{\Delta}}\) <span class="green">E</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{synthesizeSpread} :: \Gamma \rightarrow e \rightarrow (\Delta_k,\ [A_L])\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>I added typechecking rules that for primitives, containers, declarations and
signatures. The primitive rules are axioms where the types are inferred by the
lexer. The containers include homogenous lists, tuples, and records. A
declaration allows a variable to be assigned to an expression. Top-level
shadowing is not allowed (i.e. no re-assignment). Also the types are
generalized, with all remaining existential variables pulled out as universal
quantifiers.</p>
</div>
<div class="paragraph">
<p>The three functions synthesisToplevel, synthesisSingular, and
synthesisSpread are all specializations of the general functions of type:</p>
</div>
<div class="paragraph">
<p><code>synthesis</code> :: L &#8594; Gamma &#8594; e &#8594; [A]</p>
</div>
<div class="paragraph">
<p>Each rule will be described in the sections below.</p>
</div>
<div class="paragraph">
<div class="title">synthesisToplevel</div>
<p>The top-level statements import/source terms, specify their type (Signature),
and build compositions from them (Declaration).</p>
</div>
<div class="paragraph">
<p>The Import rule is premised on the evalutation of \(e\), which is an entire
module body that yields a full context. The term \((A\ \Rightarrow\ \_)\) is an
inference that throws away the resulting type, being run only for the context
it generates.</p>
</div>
<div class="paragraph">
<div class="title">synthesisSpread</div>
<p>Morloc Data structures can be typed into MLang, but not directly into other
languages without additional information. For example, is [Num] in <code>C++</code> an
array or vector? Is Num a "double" or a "float"? Determining the concrete type
will require a concrete type-signature. Thus the concrete types are <em>checked</em>
rather than <em>synthesized</em>.</p>
</div>
<div class="paragraph">
<p>Synthesizing a lambda requires we choose a language. Nothing in the body of the
lambda expression specifies the language of the lambda. The language of the
subcomponents may differ from the language of the lambda or may have no
concrete binding at all (e.g., \(\lambda x . 42\)).</p>
</div>
<div class="paragraph">
<p>The Var rule handles cases where an expression with no concrete type (i.e.,
one that does not make a function call) is assigned to a variable and is then
used in a second expression. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>import pybase <span class="tok-o">(</span>map, add<span class="tok-o">)</span>
<span class="tok-nv">ys</span> <span class="tok-o">=</span> <span class="tok-o">[</span><span class="tok-m">1</span>,2,3<span class="tok-o">]</span>
foo <span class="tok-nv">x</span> <span class="tok-o">=</span> map <span class="tok-o">(</span>add x<span class="tok-o">)</span> ys</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>map</code> and <code>add</code> are both functions imported from Python3. <code>ys</code>, though, is
defined as a general list of numbers. At the location where it is defined, no
language can be inferred. It is not until <code>ys</code> is called within <code>foo</code> that its
concrete type can be inferred.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. check</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\expr{\Gamma}{e \Leftarrow A}{\Delta}\) \(\quad\quad\) Under input context \(\Gamma\), \(e\) checks against input type \(A\), with output context \(\Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{\expr{\Gamma,x:A_L}{e \Leftarrow B_L}{\Delta,x:A_L,\Theta}}{\expr{\Gamma}{\lambda x.e \Leftarrow A_L \rightarrow B_L}{\Delta}}\) <span class="green">I</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma,\alpha_L}{e \Leftarrow A_L}{\Delta,\alpha_L,\Theta}}{\expr{\Gamma}{e \Leftarrow \forall \alpha_L . A_L}{\Delta}}\) <span class="green">I</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma}{e \overset{L}{\Rightarrow} A_L}{\Theta} \quad\quad \expr{\Theta}{[\Theta]A_L\ &lt;:\ [\Theta]B_L}{\Delta}}{\expr{\Gamma}{e \Leftarrow B_L}{\Delta}}\) <span class="green">Sub</span>
   \(\quad\quad\)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{check} :: \Gamma \rightarrow e \rightarrow A \rightarrow (\Delta,\ B])\)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. apply</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\expr{\Gamma}{\apply{A}{e}{C}}{\Delta}\) \(\quad\quad\) Under \(\Gamma\), applying a function of type \(A\) to \(e\) synthesizes type \(C\), with output context \(\Delta\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\frac{\expr{\Gamma[\ea_{2L},\ \ea_{1L},\ \ea_L\ =\ \ea_{1L}\ \rightarrow\ \ea_{2L}]}{e \Leftarrow\ \ea_{1L}}{\Delta}}{\expr{\Gamma[\ea_L]}{\apply{\ea_L}{e}{\ea_{2L}}}{\Delta}}\) <strong class="green">\(\ea_L\)</strong><span class="green">App</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma,\ea_L}{\apply{[\ea_L/\alpha_L]A}{e}{C}}{\Delta}}{\expr{\Gamma}{\apply{\forall\alpha_L . A}{e}{C}}{\Delta}}\) <span class="green">App</span>
   \(\quad\quad\)
   \(\frac{\expr{\Gamma}{e \Leftarrow A}{\Delta}}{\expr{\Gamma}{\apply{A \rightarrow C}{e}{C}}{\Delta}}\)  <span class="green">App</span>
   \(\quad\quad\)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">\(\text{apply} :: \Gamma \rightarrow e \rightarrow A \rightarrow (\Delta,\ [(L,\ B)])\)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_let_polymorphism">5.4. Let polymorphism</h3>
<div class="paragraph">
<p>We depart from Hindley-Milner (HM) by excluding a let term. In HM,
expressions bound in let are generalized, allowing statements such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>let f = (forall a . a -&gt; a) in
    x = (f 42, f "lettuce")</pre>
</div>
</div>
<div class="paragraph">
<p>Where \(f\) is generalized, allowing it to retain its polymorphism. The same is
not true of variables bound in functions (in HM at least). For example, the
following Haskell expression fails to typecheck:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>foo :: (a -&gt; a) -&gt; (Int, String)
foo f = (f 42, f "lettuce")</pre>
</div>
</div>
<div class="paragraph">
<p>We do not suport let expressions or <em>let-polymorphism</em>, instead we generalize
expressions only if they are bound at the top-level (i.e. in declaration
terms). This follows the practice argued for in [<a href="#vytiniotis2010let">2</a>].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="dunfield2013complete"></a>[1] J. Dunfield &amp; N. R. Krishnaswami, Complete and easy bidirectional typechecking for higher-rank polymorphism. <em>ACM SIGPLAN Notices</em> (ACM, 2013), pp. 429442.</p>
</div>
<div class="paragraph">
<p><a id="vytiniotis2010let"></a>[2] D. Vytiniotis, S. Peyton Jones, &amp; T. Schrijvers, Let should not be generalized. <em>Proceedings of the 5th ACM SIGPLAN workshop on Types in language design and implementation</em> (ACM, 2010), pp. 3950.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-11-04 15:15:46 -0600
</div>
</div>
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments  { background: #f8f8f8; }
pre.pygments .tok-c { color: #008800; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #AA22FF; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #008800; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #008800; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #008800 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #008800; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #008800; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #008800; font-weight: bold } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #FF0000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
pre.pygments .tok-go { color: #888888 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #AA22FF } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BB4444 } /* Literal.String */
pre.pygments .tok-na { color: #BB4444 } /* Name.Attribute */
pre.pygments .tok-nb { color: #AA22FF } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #00A000 } /* Name.Function */
pre.pygments .tok-nl { color: #A0A000 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #B8860B } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BB4444 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BB4444 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BB4444 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BB4444 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BB4444 } /* Literal.String.Double */
pre.pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BB4444 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BB4444 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #B8860B } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #AA22FF } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #00A000 } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #B8860B } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #B8860B } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #B8860B } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #B8860B } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>