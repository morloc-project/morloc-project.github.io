<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<meta name="author" content="Zebulun Arendsee">
<link rel="icon" type="image/x-icon" href="static/img/favicon.ico">
<title>Morloc Manual</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock pre>code{display:block}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #F00 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #04D } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #00F; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #800 } /* Name.Constant */
pre.pygments .tok-nd { color: #A2F } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #00F } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #00F; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #A2F; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #BBB } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #00F } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666 } /* Literal.Number.Integer.Long */
</style>
<meta
	name="keywords"
	content="asciidoctor, template, pitch black, jet black, black, adoc, dark mode"
/>
<meta name="description" content="The Morloc Manual website." />
<meta name="theme-color" content="#000000" />
<meta property="og:site_name" content="Morloc Manual" />
<meta property="og:title" content="Morloc Manual" />
<meta property="og:type" content="website" />
<meta property="og:description" content="The Morloc Manual website." />
<meta
	property="og:url"
	content="https://morloc-project.github.io/docs"
/>
<meta
	property="og:image"
	content="./static/img/icon-512.png"
/>
<meta property="og:image:width" content="512" />
<meta property="og:image:height" content="512" />
<meta
	property="twitter:image"
	content="./static/img/icon-512.png"
/>

<script defer src="static/js/script.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll('pre > code').forEach(function(codeBlock) {
    var isConsole = codeBlock.getAttribute('data-lang') === 'console';

    var button = document.createElement('button');
    button.className = 'copy-button';
    button.type = 'button';
    button.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"
        class="copy-icon">
        <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path>
      </svg>
    `;

    button.addEventListener('click', function() {
      let text = codeBlock.innerText;
      if (isConsole) {
        text = text.split('\n').map(line => line.replace(/^\$\s/, '')).join('\n');
      }
      navigator.clipboard.writeText(text).then(function() {
        button.classList.add('copied');
        setTimeout(function() { button.classList.remove('copied'); }, 300);
      });
    });

    var pre = codeBlock.parentNode.parentNode;
    pre.style.position = 'relative';
    button.style.position = 'absolute';
    button.style.top = '0.5em';
    button.style.right = '0.5em';
    pre.appendChild(button);
  });
});
</script>


<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=PT+Mono&family=Montserrat&display=swap"
	rel="stylesheet"
/>

<link rel="stylesheet" href="static/css/style.css" />
<link rel="stylesheet" href="static/css/pygments-light.css") />
<link rel="stylesheet" href="static/css/pygments-dark.css") />

<link rel="apple-touch-icon" href="static/img/icon-192.png" />

<link rel="manifest" href="manifest.webmanifest" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Morloc Manual</h1>
<div class="details">
<span id="author" class="author">Zebulun Arendsee</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_intro">1. Intro</a></li>
<li><a href="#_why_morloc">2. Why Morloc?</a>
<ul class="sectlevel2">
<li><a href="#_compose_functions_across_languages_under_a_common_type_system">2.1. Compose functions across languages under a common type system</a></li>
<li><a href="#_write_in_your_favorite_language_share_with_everyone">2.2. Write in your favorite language, share with everyone</a></li>
<li><a href="#_run_benchmarks_and_tests_across_languages">2.3. Run benchmarks and tests across languages</a></li>
<li><a href="#_design_universal_libraries">2.4. Design universal libraries</a></li>
<li><a href="#_make_better_bioinformatics_workflows">2.5. Make better bioinformatics workflows</a></li>
</ul>
</li>
<li><a href="#_current_status">3. Current status</a></li>
<li><a href="#_getting_started">4. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_installing_morloc">4.1. Installing Morloc</a></li>
<li><a href="#_handling_dependencies">4.2. Handling dependencies</a></li>
<li><a href="#_setting_up_ides">4.3. Setting up IDEs</a></li>
<li><a href="#_say_hello">4.4. Say hello</a></li>
<li><a href="#_dice_rolling">4.5. Dice rolling</a></li>
<li><a href="#_polyglot_dice_rolling">4.6. Polyglot dice rolling</a></li>
<li><a href="#_parallelism_example">4.7. Parallelism example</a></li>
</ul>
</li>
<li><a href="#_syntax_and_features">5. Syntax and Features</a>
<ul class="sectlevel2">
<li><a href="#_general_data_types">5.1. General data types</a></li>
<li><a href="#_pattern_functions_for_data_accessupdate">5.2. Pattern functions for data access/update</a></li>
<li><a href="#_source_function_from_foreign_languages">5.3. Source function from foreign languages</a></li>
<li><a href="#_functions">5.4. Functions</a></li>
<li><a href="#_modules">5.5. Modules</a></li>
<li><a href="#_docstrings">5.6. Docstrings</a></li>
<li><a href="#_composable_command_line_tools">5.7. Composable command line tools</a></li>
<li><a href="#_user_arguments_and_outputs">5.8. User arguments and outputs</a></li>
<li><a href="#_mapping_general_types_to_native_types">5.9. Mapping general types to native types</a></li>
<li><a href="#_records">5.10. Records</a></li>
<li><a href="#_tables">5.11. Tables</a></li>
<li><a href="#_type_hierarchies">5.12. Type hierarchies</a></li>
<li><a href="#_one_term_may_have_many_definitions">5.13. One term may have many definitions</a></li>
<li><a href="#_overload_terms_with_typeclasses">5.14. Overload terms with typeclasses</a></li>
<li><a href="#_binary_forms">5.15. Binary forms</a></li>
<li><a href="#_defining_non_primitive_types">5.16. Defining non-primitive types</a></li>
</ul>
</li>
<li><a href="#_ecosystem">6. Ecosystem</a>
<ul class="sectlevel2">
<li><a href="#_the_universal_library">6.1. The universal library</a></li>
<li><a href="#_planes_of_libraries">6.2. Planes of libraries</a></li>
</ul>
</li>
<li><a href="#_internals">7. Internals</a>
<ul class="sectlevel2">
<li><a href="#_packet_protocols">7.1. Packet protocols</a></li>
</ul>
</li>
<li><a href="#_qa">8. Q&amp;A</a>
<ul class="sectlevel2">
<li><a href="#_i_only_use_one_language_is_morloc_still_useful">8.1. I only use one language, is Morloc still useful?</a></li>
<li><a href="#_is_this_just_a_bioinformatics_workflow_language">8.2. Is this just a bioinformatics workflow language?</a></li>
<li><a href="#_do_you_really_want_to_deprecate_all_the_bioinformatics_formats">8.3. Do you really want to deprecate all the bioinformatics formats?</a></li>
<li><a href="#_do_you_really_want_to_deprecate_all_the_bioinformatics_applications">8.4. Do you really want to deprecate all the bioinformatics applications?</a></li>
<li><a href="#_do_you_want_to_deprecate_the_conventional_workflow_languages">8.5. Do you want to deprecate the conventional workflow languages?</a></li>
<li><a href="#_does_morloc_allow_function_specific_environments">8.6. Does Morloc allow function-specific environments?</a></li>
<li><a href="#_what_about_recursion">8.7. What about recursion?</a></li>
<li><a href="#_what_about_object_oriented_programming">8.8. What about object-oriented programming?</a></li>
<li><a href="#_is_morloc_still_relevant_when_ai_can_program_and_translate">8.9. Is Morloc still relevant when AI can program and translate?</a></li>
<li><a href="#_why_is_it_named_after_morlocks_werent_they_like_bad">8.10. Why is it named after Morlocks, weren&#8217;t they, like, bad?</a></li>
<li><a href="#_wait_i_have_more_questions">8.11. Wait! I have more questions!</a></li>
</ul>
</li>
<li><a href="#_contact">9. Contact</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="stemblock">
<div class="content">
\[
\def\ea{\widehat{\alpha}}
\def\eb{\widehat{\beta}}
\def\eg{\widehat{\gamma}}
\def\sep{ \quad\quad}
\newcommand{\mark}[1]{\blacktriangleright_{#1}}
\newcommand{\expr}[3]{#1\ \ \vdash\ #2\ \dashv\ \ #3}
\newcommand{\packto}[2]{#1\ \approx &gt;\ #2}
\newcommand{\apply}[3]{#1 \bullet #2\ \Rightarrow {\kern -1em} \Rightarrow\ #3}
\newcommand{\subtype}[2]{#1\ :\leqq\ #2}
\newcommand{\braced}[1]{\lbrace #1 \rbrace}
\]
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intro"><a class="anchor" href="#_intro"></a>1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Morloc is a strongly-typed functional programming language where functions are
imported from foreign languages and unified through a common type system. This
language is designed to serve as the foundation for a universal library of
functions. Each function in the library has one general type and zero or more
implementations. An implementation may be either a function sourced from a
foreign language or a composition of such functions. All interop code is
generated by the Morloc compiler.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_morloc"><a class="anchor" href="#_why_morloc"></a>2. Why Morloc?</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compose_functions_across_languages_under_a_common_type_system"><a class="anchor" href="#_compose_functions_across_languages_under_a_common_type_system"></a>2.1. Compose functions across languages under a common type system</h3>
<div class="paragraph">
<p>Morloc allows functions from polyglot libraries to be composed in a simple
functional language. The focus isn’t on classic interoperability (e.g., calling
Python from C) or serialization (e.g., sending data between applications via
protobufs)&#8201;&#8212;&#8201;though morloc implementations may use these under the
hood. Instead, you define types, import implementations, and build complex
programs through function composition. The compiler invisibly generates any
required interop code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_write_in_your_favorite_language_share_with_everyone"><a class="anchor" href="#_write_in_your_favorite_language_share_with_everyone"></a>2.2. Write in your favorite language, share with everyone</h3>
<div class="paragraph">
<p>Do you <em>want</em> to write in language X but <em>have</em> to write in language Y because
everyone in your team does or because your expected users do? Love C for
algorithms, R for statistics, but don’t want to write full apps in either?
Morloc lets you mix and match, so you can use each language where it shines,
with no bindings or boilerplate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_run_benchmarks_and_tests_across_languages"><a class="anchor" href="#_run_benchmarks_and_tests_across_languages"></a>2.3. Run benchmarks and tests across languages</h3>
<div class="paragraph">
<p>Tired of learning new benchmark and testing suites across all your languages? Is
it hard to benchmark similar tools wrapped in applications with varying input
formats, input validation costs, or startup overhead? In Morloc, functions
with the same general type signature can be swapped in and out for benchmarking
and testing. The same test suites and test cases will work across all supported
languages because inputs/output of all functions of the same type share
equivalent Morloc binary forms, making validation and comparison easy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_design_universal_libraries"><a class="anchor" href="#_design_universal_libraries"></a>2.4. Design universal libraries</h3>
<div class="paragraph">
<p>With Morloc, we can build abstract libraries using the general types as a
logical framework. Then we can import implementations of these functions from
one or more of the supported languages and easily test and benchmark them. These
libraries are the foundation for an ecosystem where functions may be verified,
organized/searched by type, and used to build rigorous programs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_make_better_bioinformatics_workflows"><a class="anchor" href="#_make_better_bioinformatics_workflows"></a>2.5. Make better bioinformatics workflows</h3>
<div class="paragraph">
<p>Within the bioinformatics space, Morloc can serve as a replacement for the
brittle application/file paradigm of workflow design. Replace heavy CLI
applications with pure function libraries, ad hoc textual file formats with
explicit data structures, and workflow specifications with function
compositions. See the the first Morloc
paper for details (<a href="https://www.zebulun-arendsee.com/images/morloc-paper-001.pdf">pre-released here</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_current_status"><a class="anchor" href="#_current_status"></a>3. Current status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Morloc is under heavy development in several areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>language support</strong> – We need to further standardize the language onboarding
process and then start adding new languages beyond the three that are
currently supported (Python, R, and C&#43;&#43;)</p>
</li>
<li>
<p><strong>type system</strong> – There’s lots to do here: sum types, effect handling,
constraints, extensible records</p>
</li>
<li>
<p><strong>performance</strong> – The shared library implementation lacks proper memory
defragmentation, and there is some unnecessary memory copying between
languages</p>
</li>
<li>
<p><strong>scaling</strong> – I’ve implemented some of the infrastructure and syntax for remote
job submission, but more work is needed before it can be used in practice</p>
</li>
<li>
<p><strong>syntax</strong> – Pattern matching, custom operators, namespaces, string
interpolation, and more are on the roadmap</p>
</li>
<li>
<p><strong>tooling</strong> – We need a linter, debugger, dependency manager, and better
backend generators that produce better CLI usage statements and programmatic APIs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is one island of stability, though: the native functions Morloc imports
are fully independent of Morloc itself. For a given Morloc program, most of your
code will be pure functions in native languages (e.g., Python, C&#43;&#43;, or
R). This code will never have to change between Morloc versions. Where Morloc
will change is in how it describes these native functions, the syntax it uses to
compose them, and the particulars of code generation.</p>
</div>
<div class="paragraph">
<p>Is Morloc ready for production? Maybe. Currently, Morloc has many sharp edges,
and new versions may introduce breaking changes. So Morloc is most appropriate
right now for adventurous first adopters who can solve problems and write clear
issue reports. Morloc may be about one year of full-time work away from v1.0.</p>
</div>
<div class="paragraph">
<p><strong>Want to contribute?</strong> The most helpful thing you can do is join the community (see
the Contact section), try out Morloc, and offer feedback on social media or via
GitHub issue reports. The community is just starting, and the language is young,
so you can strongly influence how the system evolves.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>4. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installing_morloc"><a class="anchor" href="#_installing_morloc"></a>4.1. Installing Morloc</h3>
<div class="paragraph">
<p>The easiest way to run Morloc is through containers in a UNIX environment. Linux
will work natively. MacOS and Windows are more complicated and I&#8217;ll deal with
their special later on. For Windows, you will need to install through the
<a href="https://learn.microsoft.com/en-us/windows/wsl/about">Windows Subsystem for Linux</a>.</p>
</div>
<div class="paragraph">
<p>The only dependency is a container engine, currently two
<a href="https://docs.docker.com/engine/install/">docker</a> and
<a href="https://podman.io/docs/installation">podman</a> are supported.</p>
</div>
<details>
<summary class="title">Podman instructions</summary>
<div class="content">
<div class="paragraph">
<p>Unlike Docker, <code>podman</code> runs rootless by default, so no sudo is required. On
Linux, it also runs natively with no daemons.</p>
</div>
<div class="paragraph">
<p>On MacOS and Windows (even through WSL), a virtual machine is required. So you
will need to initialize <code>podman</code> as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>podman<span class="tok-w"> </span>init
<span class="tok-gp">$ </span>podman<span class="tok-w"> </span>start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can confirm that podman is running by entering</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>podman<span class="tok-w"> </span>--version
<span class="tok-go">podman version 5.4.1   # version on my current setup</span></code></pre>
</div>
</div>
<hr>
</div>
</details>
<details>
<summary class="title">Docker instructions</summary>
<div class="content">
<div class="paragraph">
<p>TBD</p>
</div>
<hr>
</div>
</details>
<div class="paragraph">
<p>After confirming either Podman or Docker is running on your system, pull an
installation script from
<a href="https://github.com/morloc-project/morloc-manager">morloc-project/morloc-manager</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>curl<span class="tok-w"> </span>-o<span class="tok-w"> </span>morloc-manager<span class="tok-w"> </span>https://raw.githubusercontent.com/morloc-project/morloc-manager/refs/heads/main/morloc-manager.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script provides usage information on request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>sh<span class="tok-w"> </span>morloc-manager<span class="tok-w"> </span>-h
<span class="tok-gp">$ </span>sh<span class="tok-w"> </span>morloc-manager<span class="tok-w"> </span>install<span class="tok-w"> </span>-h
<span class="tok-gp">$ </span>sh<span class="tok-w"> </span>morloc-manager<span class="tok-w"> </span>uninstall<span class="tok-w"> </span>-h</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>install</code> subcommand will build the Morloc home directory, install required
containers, and generate four executable scripts.</p>
</div>
<div class="paragraph">
<p><strong>The first script is <code>menv</code></strong>. It runs arbitrary commands in a Morloc container. It
can be used to compile and run Morloc programs. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>menv<span class="tok-w"> </span>morloc<span class="tok-w"> </span>make<span class="tok-w"> </span>-o<span class="tok-w"> </span>foo<span class="tok-w"> </span>foo.loc
<span class="tok-gp">$ </span>menv<span class="tok-w"> </span>./foo<span class="tok-w"> </span>double<span class="tok-w"> </span><span class="tok-m">21</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>menv</code> script mounts the working directory and the <code>~/.local/share/morloc/&lt;version&gt;</code>
directory. It builds the program using the containers version of the Morloc
compiler and Morloc libraries that are defined in the version-specific home
directory. It cannot see any dependencies on your local system.</p>
</div>
<div class="paragraph">
<p><strong>The second script is <code>morloc-shell</code></strong>. This script is the same as the above script
except that you enter the container in an interactive shell rather than just
running one command. The container has installations for Python, R, and C++
compiler. It also contains vim and other conveniences</p>
</div>
<div class="paragraph">
<p><strong>The third script is <code>menv-dev</code></strong>. This runs commands in a dev container where all
Haskell tools required for building Morloc from source are installed. To build
Morloc from source, do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>git<span class="tok-w"> </span>clone<span class="tok-w"> </span>git@github.com:morloc-project/morloc
<span class="tok-gp">$ </span><span class="tok-nb">cd</span><span class="tok-w"> </span>morloc
<span class="tok-gp">$ </span>menv-dev<span class="tok-w"> </span>stack<span class="tok-w"> </span>install<span class="tok-w"> </span>--fast
<span class="tok-gp">$ </span>menv-dev<span class="tok-w"> </span>stack<span class="tok-w"> </span><span class="tok-nb">test</span><span class="tok-w"> </span>--fast</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will build the version that was cloned from GitHub. Now you can use
<code>menv-dev</code> as you would <code>menv</code>.</p>
</div>
<div class="paragraph">
<p><strong>The fourth script is <code>morloc-shell-dev</code></strong>. This script lets you enter the dev
shell.</p>
</div>
<div class="paragraph">
<p>The Morloc compiler always considers <code>~/.local/share/morloc</code> to be the
Morloc home directory. The containers mount separate folders from the local
<code>~/.local/share/morloc/versions</code> folder to this expected home directory in the
container. This means the different versions of Morloc installed, as well as the
special <code>local</code> version used by the dev container, do not have overlapping
libraries and modules.</p>
</div>
<div class="paragraph">
<p>Throughout the rest of this manual, whenever I show an example that uses
Morloc, you can assume that I am running it from within a container after
calling <code>morloc-shell</code> or <code>morloc-shell-dev</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handling_dependencies"><a class="anchor" href="#_handling_dependencies"></a>4.2. Handling dependencies</h3>
<div class="paragraph">
<p>The <code>morloc-manager</code> script will install the Morloc compiler and default
language run-times. This is sufficient to play with Morloc and run most of the
demos. However, if you write any code that has additional dependencies, you will
need to augment the environment. As of v0.5.0, the <code>morloc-manager</code> provides
support for specifying containers that build on the default containers.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we want to create a new environment for scientific computing with Python:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc-manager<span class="tok-w"> </span>env<span class="tok-w"> </span>--init<span class="tok-w"> </span>scipy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a stub Dockerfile at
<code>~/.local/share/morloc/deps/scipy.Dockerfile</code>. It can be modified to specify
whatever additional dependencies are needed. Then the environment can be built
and selected as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc-manager<span class="tok-w"> </span>env<span class="tok-w"> </span>scipy</code></pre>
</div>
</div>
<div class="paragraph">
<p>All existing environments can be listed as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc-manager<span class="tok-w"> </span>env<span class="tok-w"> </span>--list</code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature is new and still experimental. Any feedback would be appreciated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_ides"><a class="anchor" href="#_setting_up_ides"></a>4.3. Setting up IDEs</h3>
<div class="paragraph">
<p>We are currently working on expanding the editor support for Morloc.</p>
</div>
<div class="paragraph">
<p>Here are supported editors</p>
</div>
<details>
<summary class="title">vim</summary>
<div class="content">
<div class="paragraph">
<p>If you are working in vim, you can install Morloc syntax highlighting as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="console"><span></span><span class="tok-gp">$ </span>mkdir<span class="tok-w"> </span>-p<span class="tok-w"> </span>~/.vim/syntax/
<span class="tok-gp">$ </span>mkdir<span class="tok-w"> </span>-p<span class="tok-w"> </span>~/.vim/ftdetect/
<span class="tok-gp">$ </span>curl<span class="tok-w"> </span>-o<span class="tok-w"> </span>~/.vim/syntax/loc.vim<span class="tok-w"> </span>https://raw.githubusercontent.com/morloc-project/vimmorloc/main/loc.vim
<span class="tok-gp">$ </span><span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-s1">&#39;au BufRead,BufNewFile *.loc set filetype=loc&#39;</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>~/.vim/ftdetect/loc.vim</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="static/img/vim-highlights.png" alt="vim highlights">
</div>
</div>
<hr>
</div>
</details>
<details>
<summary class="title">VS Code / VSCodium / Cursor</summary>
<div class="content">
<div class="paragraph">
<p>We have a publicly available "morloc" extension with support for highlighting
and snippet expansion.</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="static/img/vscode-highlights.png" alt="vscode highlights">
</div>
</div>
<hr>
</div>
</details>
<details>
<summary class="title">Zed</summary>
<div class="content">
<div class="paragraph">
<p>This is currently under development, see repo <a href="https://github.com/morloc-project/zed-morloc">here</a>.</p>
</div>
<div class="paragraph">
<p>The extension is mostly written, and the required Tree-sitter grammar is
written, but there are bugs to be resolved. I&#8217;m happy to accept pull requests!</p>
</div>
</div>
</details>
<div class="paragraph">
<p>I&#8217;ve also written several syntax highlighting and static analysis tools:</p>
</div>
<details>
<summary class="title">Pygmentize</summary>
<div class="content">
<div class="paragraph">
<p>A repo with the Pygmentize parser can be found
<a href="https://github.com/morloc-project/pygmentize">here</a>. This parser is used to
highlight code here in the manual. It can be easily integrated into Python code,
e.g., in the <a href="https://github.com/morloc-project/weena-bot">Weena discord bot</a>.</p>
</div>
</div>
</details>
<details>
<summary class="title">TextMate</summary>
<div class="content">

</div>
</details>
<details>
<summary class="title">Tree-sitter</summary>
<div class="content">
<div class="paragraph">
<p>Tree-sitter is a program for defining parsers and using them to query languages
and add advanced grammatical understanding to editors. These grammars require a
complete lexer and parser specification for the language. This grammar is
available for Morloc, see repo
<a href="https://github.com/morloc-project/tree-sitter-morloc">here</a>. Tree-sitter allows
general purpose syntax highlighting (e.g., over the command line) and parses a
full concrete syntax tree from the code:</p>
</div>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="static/img/tree-sitter.png" alt="tree sitter">
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_say_hello"><a class="anchor" href="#_say_hello"></a>4.4. Say hello</h3>
<div class="paragraph">
<p>The inevitable "Hello World" case is implemented in Morloc like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">main</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">hello</span><span class="tok-p">)</span>
<span class="tok-n">hello</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;Hello up there&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The module named <code>main</code> exports the term <code>hello</code> which is assigned to a literal
string value.</p>
</div>
<div class="paragraph">
<p>Paste this code into a file (e.g. "hello.loc") and then it can be imported by
other Morloc modules or directly compiled into a program where every exported
term is a subcommand.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc<span class="tok-w"> </span>make<span class="tok-w"> </span>hello.loc</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will produce two files: a C program, <code>nexus.c</code>, and its compiled
binary, <code>nexus</code>. The <code>nexus</code> is the command line interface (CLI) to the commands
exported from the module.</p>
</div>
<div class="paragraph">
<p>Calling <code>nexus</code> with no arguments or with the <code>-h</code> flag, will print a help
message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus [OPTION]... COMMAND [ARG]...</span>

<span class="tok-go">Nexus Options:</span>
<span class="tok-go"> -h, --help            Print this help message</span>
<span class="tok-go"> -o, --output-file     Print to this file instead of STDOUT</span>
<span class="tok-go"> -f, --output-format   Output format [json|mpk|voidstar]</span>

<span class="tok-go">Exported Commands:</span>
<span class="tok-go">  hello</span>
<span class="tok-go">    return: Str</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This usage message is automatically generated. For each exported term, it
specifies the input (none, in this case) and output types as inferred by the
compiler. For this case, the exported command is just the term <code>hello</code>, so no
input types are listed.</p>
</div>
<div class="paragraph">
<p>The command is called as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>hello
<span class="tok-go">Hello up there</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dice_rolling"><a class="anchor" href="#_dice_rolling"></a>4.5. Dice rolling</h3>
<div class="paragraph">
<p>Let&#8217;s write a little program rolls a pair of 20-sided dice and prints the larger
result. Here is the Morloc script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">dnd</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">rollAdv</span><span class="tok-p">)</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">types</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;roll&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;max&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;narrate&quot;</span><span class="tok-p">)</span>

<span class="tok-n">roll</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span>
<span class="tok-n">max</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int</span>
<span class="tok-n">narrate</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Str</span>

<span class="tok-n">rollAdv</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">narrate</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">max</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">roll</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-mi">20</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we define a module named <code>dnd</code> that exports the function <code>rollAdv</code>. In line
2, we import the required type definitions from the Morloc module
<code>types</code>. Later on we&#8217;ll go into how these types are defined. In line 3, we
source three functions from the Python file "foo.py". In lines 5-8, we assign
each of these functions a Morloc type signature. You can think of the arrows
in the signatures as separating arguments. For example, the function <code>roll</code>
takes two integers as arguments and returns a list of integers. The square
brackets indicate lists. In the final line, we define the <code>rollAdv</code> function.</p>
</div>
<div class="paragraph">
<p>The Python functions are sourced from the Python file "foo.py" with the
following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">random</span>

<span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">roll</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-p">):</span>
    <span class="tok-c1"># Roll an n-sided die d times, return a list of results</span>
    <span class="tok-k">return</span> <span class="tok-p">[</span><span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-n">randint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-n">d</span><span class="tok-p">)</span> <span class="tok-k">for</span> <span class="tok-n">_</span> <span class="tok-ow">in</span> <span class="tok-nb">range</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">)]</span>

<span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">narrate</span><span class="tok-p">(</span><span class="tok-n">roll_value</span><span class="tok-p">):</span>
    <span class="tok-k">return</span> <span class="tok-sa">f</span><span class="tok-s2">&quot;You rolled a </span><span class="tok-si">{</span><span class="tok-n">roll_value</span><span class="tok-si">!s}</span><span class="tok-s2">&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nothing about this code is particular to Morloc.</p>
</div>
<div class="paragraph">
<p>One of Morloc&#8217;s core values is that foreign source code <em>never</em> needs to know
anything about the Morloc ecosystem. Sourced code should always be nearly
idiomatic code that uses normal data types. The inputs and outputs of these
functions are natural Python integers, lists, and strings&#8201;&#8212;&#8201;they are not
Morloc-specific serialized data or ad hoc textual formats.</p>
</div>
<div class="paragraph">
<p>This module is dependent on the <code>types</code> module, which in turn is dependent on
the <code>prelude</code> module. So before compiling, we need to import both of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">morloc import prelude</span>
<span class="tok-go">morloc import types</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can compile and run this program as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc<span class="tok-w"> </span>make<span class="tok-w"> </span>main.loc
<span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>rollAdv
<span class="tok-go">&quot;You rolled a 20&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a random function, it will return a new result every time.</p>
</div>
<div class="paragraph">
<p>So, what&#8217;s the point? We could have done this more easily in a pure Python
script. Morloc generates a CLI for us, type checks the program, and performs
some runtime validation (by default, just on the final inputs and outputs). But
there are other tools in the Python universe can achieve this same end. Where
Morloc is uniquely valuable is in the polyglot setting.</p>
</div>
</div>
<div class="sect2">
<h3 id="_polyglot_dice_rolling"><a class="anchor" href="#_polyglot_dice_rolling"></a>4.6. Polyglot dice rolling</h3>
<div class="paragraph">
<p>In this next example, we rewrite the prior dice example with all three functions
being sourced from different languages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">dnd</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">rollAdv</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">types</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.R&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;roll&quot;</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;max&quot;</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;narrate&quot;</span><span class="tok-p">)</span>

<span class="tok-n">roll</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span>
<span class="tok-n">max</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int</span>
<span class="tok-n">narrate</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Str</span>

<span class="tok-n">rollAdv</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">narrate</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">max</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">roll</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-mi">20</span><span class="tok-p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that all of this code is exactly the same as in the prior example except
the source statements.</p>
</div>
<div class="paragraph">
<p>The <code>roll</code> function is defined in R:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="r"><span></span><span class="tok-n">roll</span><span class="tok-w"> </span><span class="tok-o">&lt;-</span><span class="tok-w"> </span><span class="tok-kr">function</span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">d</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-nf">sample</span><span class="tok-p">(</span><span class="tok-m">1</span><span class="tok-o">:</span><span class="tok-n">d</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>max</code> function is defined in C&#43;&#43;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span class="tok-cp">#pragma one</span>
<span class="tok-cp">#include</span><span class="tok-w"> </span><span class="tok-cpf">&lt;vector&gt;</span>
<span class="tok-cp">#include</span><span class="tok-w"> </span><span class="tok-cpf">&lt;algorithm&gt;</span>

<span class="tok-k">template</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">A</span><span class="tok-o">&gt;</span>
<span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">max</span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-o">&gt;&amp;</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">max_element</span><span class="tok-p">(</span><span class="tok-n">xs</span><span class="tok-p">.</span><span class="tok-n">begin</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">.</span><span class="tok-n">end</span><span class="tok-p">());</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>narrate</code> function is defined in Python:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">narrate</span><span class="tok-p">(</span><span class="tok-n">roll_value</span><span class="tok-p">):</span>
    <span class="tok-k">return</span> <span class="tok-sa">f</span><span class="tok-s2">&quot;You rolled a </span><span class="tok-si">{</span><span class="tok-n">roll_value</span><span class="tok-si">!s}</span><span class="tok-s2">&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be compiled and run in exactly the same way as the prior monoglot
example. It will run a bit slower, mostly because of the heavy cost of starting
the R interpreter.</p>
</div>
<div class="paragraph">
<p>The Morloc compiler automatically generates all code required to translate data
between the languages. Exactly how this is done will be discussed later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_parallelism_example"><a class="anchor" href="#_parallelism_example"></a>4.7. Parallelism example</h3>
<div class="paragraph">
<p>Here is an example showing a parallel map function written in Python that calls C&#43;&#43; functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">m</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sumOfSums</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">types</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;pmap&quot;</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;sum&quot;</span><span class="tok-p">)</span>

<span class="tok-n">pmap</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">a</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">b</span><span class="tok-p">]</span>
<span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Real</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span>

<span class="tok-n">sumOfSums</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-err">.</span><span class="tok-w"> </span><span class="tok-n">pmap</span><span class="tok-w"> </span><span class="tok-n">sum</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This Morloc script exports a function that sums a list of lists of real
numbers. Here we use the dot operator for function composition. The sum function
is implemented in C&#43;&#43;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span class="tok-c1">// C++ header sourced by morloc script</span>
<span class="tok-cp">#pragma one</span>
<span class="tok-cp">#include</span><span class="tok-w"> </span><span class="tok-cpf">&lt;vector&gt;</span>

<span class="tok-kt">double</span><span class="tok-w"> </span><span class="tok-nf">sum</span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-kt">double</span><span class="tok-o">&gt;&amp;</span><span class="tok-w"> </span><span class="tok-n">vec</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kt">double</span><span class="tok-w"> </span><span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mf">0.0</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-kt">double</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">:</span><span class="tok-w"> </span><span class="tok-n">vec</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">sum</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The parallel <code>pmap</code> function is written in Python:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-c1"># Python3 file sourced by morloc script</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">multiprocessing</span><span class="tok-w"> </span><span class="tok-k">as</span><span class="tok-w"> </span><span class="tok-nn">mp</span>

<span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">pmap</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">,</span> <span class="tok-n">xs</span><span class="tok-p">):</span>
    <span class="tok-k">with</span> <span class="tok-n">mp</span><span class="tok-o">.</span><span class="tok-n">Pool</span><span class="tok-p">()</span> <span class="tok-k">as</span> <span class="tok-n">pool</span><span class="tok-p">:</span>
        <span class="tok-n">results</span> <span class="tok-o">=</span> <span class="tok-n">pool</span><span class="tok-o">.</span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">,</span> <span class="tok-n">xs</span><span class="tok-p">)</span>
    <span class="tok-k">return</span> <span class="tok-n">results</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The inner summation jobs will be run in parallel. The <code>pmap</code> function has the
same signature as the non-parallel <code>map</code> function, so can serve as a drop-in
replacement.</p>
</div>
<div class="paragraph">
<p>This can be compiled and run with the lists being provided in JSON format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc<span class="tok-w"> </span>make<span class="tok-w"> </span>main.loc
<span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>sumOfSums<span class="tok-w"> </span><span class="tok-s1">&#39;[[1,2],[3,4,5]]&#39;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax_and_features"><a class="anchor" href="#_syntax_and_features"></a>5. Syntax and Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_data_types"><a class="anchor" href="#_general_data_types"></a>5.1. General data types</h3>
<div class="paragraph">
<p>Morloc supports standard primitives, homogenous lists, and tuples.</p>
</div>
<div class="paragraph">
<div class="title">Booleans</div>
<p>Booleans in Morloc are represented as <code>True</code> or <code>False</code> under the <code>Bool</code> type.</p>
</div>
<div class="paragraph">
<div class="title">Numbers</div>
<p>Numbers may be represented in normal format, scientific notation, or as
hexidecimal/octal/binary format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-c1">-- standard notation for integers and floats</span>
<span class="tok-mi">42</span>
<span class="tok-mf">4.2</span>

<span class="tok-c1">-- scientific notation (upper or lowercase &#39;e&#39;)</span>
<span class="tok-mf">4.2E16</span>
<span class="tok-mf">4.2e16</span>
<span class="tok-mf">4.2e-8</span>

<span class="tok-c1">-- hexadecimal notation (case insensitive)</span>
<span class="tok-mh">0xf00d</span>
<span class="tok-mh">0xDEADBEAF</span>

<span class="tok-c1">-- octal notation (upper or lowercase &#39;o&#39;)</span>
<span class="tok-mo">0o755</span>

<span class="tok-c1">-- binary notation (upper or lowercase &#39;b&#39;)</span>
<span class="tok-mb">0b0101</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Strings</div>
<p>Morloc supports multi-line strings and string interpolation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-c1">-- string interpolation, the value inside #{...} must be a string</span>
<span class="tok-c1">-- no automatic stringifiction is supported yet (but will be soon)</span>
<span class="tok-n">helloYou</span><span class="tok-w"> </span><span class="tok-n">you</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;hello </span><span class="tok-si">#{</span><span class="tok-n">you</span><span class="tok-si">}</span><span class="tok-s">&quot;</span>

<span class="tok-n">longString</span><span class="tok-w"> </span><span class="tok-ow">=</span>
<span class="tok-w">  </span><span class="tok-s">&quot;&quot;&quot;</span>
<span class="tok-s">  this is a long</span>
<span class="tok-s">  string</span>
<span class="tok-s">  &quot;&quot;&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Tuples</div>
<p>Tuples may be used to store a fixed number of terms of different type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">True</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mf">6.45</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Records</div>
<p>Records are essentially named tuples. Record type definitions and
language-specific handling will be addressed later, but record data is expressed
as shown in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;Alice&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">42</span><span class="tok-w"> </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Lists</div>
<p>Lists are used to store a variable number of terms of the same type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lists do not yet have special accessors, but these are in the work and will use
slicing syntax similar to that of Python.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pattern_functions_for_data_accessupdate"><a class="anchor" href="#_pattern_functions_for_data_accessupdate"></a>5.2. Pattern functions for data access/update</h3>
<div class="paragraph">
<p>Data structures may be accessed and modified using pattern functions. These
patterns may be <em>getters</em> that extract a tuple of values from a data structure
or <em>setters</em> that update a data structure without changing its type.</p>
</div>
<div class="paragraph">
<div class="title">getters patterns</div>
<p>A <strong>getter</strong> pattern describes an optionally branching path into a data
structure. Each segment of the path may be a tuple index, a record key, or a
group of indices/keys. The terminal positions in the pattern are returned as
elements in a tuple. Here are a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-c1">-- return the 1st element in a tuple of any size</span>
.0<span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- return 1</span>
.0<span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">),</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- return (1,3)</span>

<span class="tok-c1">-- return the 2nd element in the first element of a tuple</span>
.0.1<span class="tok-w"> </span><span class="tok-p">((</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">),</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- return 3</span>

<span class="tok-c1">-- returns the 2nd and 1st elements in a tuple</span>
.(.1,.0)<span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- returns (2,1)</span>
.(.1,.0)<span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-w">   </span><span class="tok-c1">-- returns (2,1)</span>

<span class="tok-c1">-- indices and keys may be used together</span>
.0.(.x,<span class="tok-w"> </span>.y.1)<span class="tok-w"> </span><span class="tok-p">({</span><span class="tok-n">x</span><span class="tok-ow">=</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-ow">=</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-ow">=</span><span class="tok-mi">3</span><span class="tok-p">},</span><span class="tok-w"> </span><span class="tok-mi">6</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- returns (1,2)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These patterns are transformed into functions may be used exactly like any other
function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span>.1<span class="tok-w"> </span><span class="tok-p">[(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">),(</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">)]</span><span class="tok-w"> </span><span class="tok-c1">-- returns [2,3]</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">setters patterns</div>
<p>Setter patterns are similar but add an assignment statement to each pattern
terminus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span>.(.0<span class="tok-w"> </span>=<span class="tok-w"> </span><span class="tok-mi">99</span>)<span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- return (99,2)</span>

<span class="tok-c1">-- indices and keys may be used together</span>
.0.(.x=<span class="tok-mi">99</span>,<span class="tok-w"> </span>.y.1=<span class="tok-mi">33</span>)<span class="tok-w"> </span><span class="tok-p">({</span><span class="tok-n">x</span><span class="tok-ow">=</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-ow">=</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">),</span><span class="tok-w"> </span><span class="tok-n">z</span><span class="tok-ow">=</span><span class="tok-mi">3</span><span class="tok-p">},</span><span class="tok-w"> </span><span class="tok-mi">6</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-c1">-- returns ({x=99, y=(1,33), z=3}, 6)</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Comparison of patterns to Python syntax</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Pattern</th>
<th class="tableblock halign-left valign-top">Python</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lambda x: x[0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patterns are functions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.0 x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x[0]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.0.k x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x[0]["k"]</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.(.1,.0) x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(x[1], x[0])</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo .0 xs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo(lambda x: x[0], xs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">higher order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.(.k = 1) x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x["k"] = 1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that setters are designed to not mutate data. The <strong>spine</strong> of the data
structure will be copied which retains links to the original data for unmodified
fields. So the expression <code>.(.0 = 42) x</code> when translated into Python will create
a new tuple with the first field being 42 and the remaining fields assigned to
elements of the original field. The same goes for records. In the future, I may
add an alternative syntax that mutates the data structure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_function_from_foreign_languages"><a class="anchor" href="#_source_function_from_foreign_languages"></a>5.3. Source function from foreign languages</h3>
<div class="paragraph">
<p>In Morloc, you can import functions from many languages and compose them under
a common type system. The syntax for importing functions from source files is as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;map&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;sum&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;snd&quot;</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;map&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;sum&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;snd&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This brings the functions <code>map</code>, <code>sum</code>, and <code>snd</code> into scope in the Morloc
script. Each of these functions must be defined in the C&#43;&#43; and Python
scripts. For Python, since <code>map</code> and <code>sum</code> are builtins, only <code>snd</code> needs to be
defined. So the <code>foo.py</code> function only requires the following two lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">snd</span><span class="tok-p">(</span><span class="tok-n">pair</span><span class="tok-p">):</span>
    <span class="tok-k">return</span> <span class="tok-n">pair</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The C&#43;&#43; file, <code>foo.hpp</code>, may be implemented as a simple header file with generic
implementations of the three required functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span class="tok-cp">#pragma once</span>
<span class="tok-cp">#include</span><span class="tok-w"> </span><span class="tok-cpf">&lt;vector&gt;</span>
<span class="tok-cp">#include</span><span class="tok-w"> </span><span class="tok-cpf">&lt;tuple&gt;</span>

<span class="tok-c1">// map :: (a -&gt; b) -&gt; [a] -&gt; [b]</span>
<span class="tok-k">template</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">A</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">B</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">F</span><span class="tok-o">&gt;</span>
<span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">B</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">map</span><span class="tok-p">(</span><span class="tok-n">F</span><span class="tok-w"> </span><span class="tok-n">f</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-o">&gt;&amp;</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">B</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">result</span><span class="tok-p">.</span><span class="tok-n">reserve</span><span class="tok-p">(</span><span class="tok-n">xs</span><span class="tok-p">.</span><span class="tok-n">size</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-k">auto</span><span class="tok-o">&amp;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">:</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">result</span><span class="tok-p">.</span><span class="tok-n">push_back</span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">));</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-c1">// snd :: (a, b) -&gt; b</span>
<span class="tok-k">template</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">A</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">B</span><span class="tok-o">&gt;</span>
<span class="tok-n">B</span><span class="tok-w"> </span><span class="tok-n">snd</span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">tuple</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">B</span><span class="tok-o">&gt;&amp;</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">get</span><span class="tok-o">&lt;</span><span class="tok-mi">1</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">);</span>
<span class="tok-p">}</span>

<span class="tok-c1">// sum :: [a] -&gt; a</span>
<span class="tok-k">template</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-k">typename</span><span class="tok-w"> </span><span class="tok-nc">A</span><span class="tok-o">&gt;</span>
<span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">sum</span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">vector</span><span class="tok-o">&lt;</span><span class="tok-n">A</span><span class="tok-o">&gt;&amp;</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">total</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">A</span><span class="tok-p">{</span><span class="tok-mi">0</span><span class="tok-p">};</span>
<span class="tok-w">    </span><span class="tok-k">for</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-k">const</span><span class="tok-w"> </span><span class="tok-k">auto</span><span class="tok-o">&amp;</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">:</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">total</span><span class="tok-w"> </span><span class="tok-o">+=</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">total</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that these implementations are completely independent of Morloc&#8201;&#8212;&#8201;they
have no special constraints, they operate on perfectly normal native data
structures, and their usage is not limited to the Morloc ecosystem. The
Morloc compiler is responsible for mapping data between the languages. But to
do this, Morloc needs a little information about the function types. This is
provided by the general type signatures, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">a</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">b</span><span class="tok-p">]</span>
<span class="tok-n">snd</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Real</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for these type signatures is inspired by Haskell, with the exception
that generic terms (<code>a</code> and <code>b</code> here) must be declared on the left. Square
brackets represent homogenous lists and parenthesized, comma-separated values
represent tuples, and arrows represent functions. In the <code>map</code> type, <code>(a &#8594; b)</code>
is a function from generic value <code>a</code> to generic value <code>b</code>;  <code>[a]</code> is the input
list of initial values; <code>[b]</code> is the output list of transformed values.</p>
</div>
<div class="paragraph">
<p>Removing the syntactic sugar for lists and tuples, the signatures may be written
as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-n">snd</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Tuple2</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These signatures provide the <em>general types</em> of the functions. But one general
type may map to multiple <em>native</em>, language-specific types. So we need to
provide an explicit mapping from general to native types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::vector&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Tuple2</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::tuple&lt;$1,$2&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;double&quot;</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;list&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Tuple2</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;tuple&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;float&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These type functions guide the synthesis of native types from general
types. Take the C&#43;&#43; mapping for <code>List a</code> as an example. The basic C&#43;&#43; list type
is <code>vector</code> from the standard template library. After the Morloc typechecker
has solved for the type of the generic parameter <code>a</code>, and recursively converted
it to C&#43;&#43;, its type will be substituted for <code>$1</code>. So if <code>a</code> is inferred to be
a <code>Real</code>, it will map to the C&#43;&#43; <code>double</code>, and then be substituted into the list
type yielding <code>std::vector&lt;double&gt;</code>. This type will be used in the generated C&#43;&#43;
code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_functions"><a class="anchor" href="#_functions"></a>5.4. Functions</h3>
<div class="paragraph">
<p>Functions are defined with arguments seperated by whitespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">g</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">f</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>foo</code> is the Morloc function name and <code>x</code> is its first argument.</p>
</div>
<div class="paragraph">
<p>Morloc supports the <code>.</code> operator for composition, so we can re-write <code>foo</code> as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">g</span><span class="tok-w"> </span><span class="tok-err">.</span><span class="tok-w"> </span><span class="tok-n">f</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Morloc supports partial application of arguments.</p>
</div>
<div class="paragraph">
<p>For example, to multiply every element in a list by 2, we can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">multiplyByTwo</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">mul</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Partial application works well for leading arguments, but what if we want to
partially apply a later argument?</p>
</div>
<div class="paragraph">
<p>For example, we can use direct partial application with subtraction to create
functions that subtract the input argument from a given value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-c1">-- returns [0,-1,-2]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if we want to do the reverse:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-err">???</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-c1">-- we want to return [0,1,2]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One solution is to use anonymous function, lambdas, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-ow">\</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">sub</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-c1">-- returns [0,1,2]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Morloc also supports a shortcut for more flexible partial application using
underscores as placeholders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sub</span><span class="tok-w"> </span><span class="tok-ow">_</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-c1">-- returns [0,1,2]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will be transformed in the compiler frontend to a lambda, so is behaves
identically. These placeholders may also be used in data structures. The
following two expressions obtain the same result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-ow">\</span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-mi">42</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span>
<span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-ow">_</span><span class="tok-p">,</span><span class="tok-mi">42</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The placeholders may be used in nested data structures as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">people</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Person</span><span class="tok-p">]</span>
<span class="tok-n">people</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">zipWith</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">country</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;Pangea&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-ow">_</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-ow">_</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s">&quot;Alice&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Bob&quot;</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">42</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">44</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple placeholders are used, the arguments generated for the lambda are
applied in left-to-right order.</p>
</div>
<div class="paragraph">
<p>Placeholders also work in string interpolation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-s">&quot;Hello </span><span class="tok-si">#{</span><span class="tok-ow">_</span><span class="tok-si">}</span><span class="tok-s">!&quot;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s">&quot;Alice&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Bob&quot;</span><span class="tok-p">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modules"><a class="anchor" href="#_modules"></a>5.5. Modules</h3>
<div class="paragraph">
<p>A module includes all the code defined under the <code>import &lt;module_name&gt;</code>
statement. It can be imported with the <code>import</code> command.</p>
</div>
<div class="paragraph">
<p>The following module defines the constant <code>x</code> and exports it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">)</span>
<span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another module can import <code>Foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">)</span>

<span class="tok-err">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A term may be imported from multiple modules. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">main</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">cppbase</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">pybase</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">rbase</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This module imports that C&#43;&#43;, Python, and R <code>add</code> functions and exports all
of them. Modules that import <code>add</code> will import three different versions of the
function. The compiler will choose which to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_docstrings"><a class="anchor" href="#_docstrings"></a>5.6. Docstrings</h3>
<div class="paragraph">
<p>Morloc has supports special handling of comments that are used to direct how the
CLI program is generated.</p>
</div>
<div class="paragraph">
<p>Here is a minimal example of propagated function descriptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-py</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;main.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;bar&quot;</span><span class="tok-p">)</span>

<span class="tok-c1">--&#39; Take two reals and do thing</span>
<span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span>

<span class="tok-c1">--&#39; Convert a list of reals into a thing</span>
<span class="tok-n">bar</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Real</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special comment <code>--'</code> introduces a docstring that is attached to the
following type signature and will be propagated through to the code generated by
the backend.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>morloc<span class="tok-w"> </span>make<span class="tok-w"> </span>main.loc
<span class="tok-gp">$ </span>./neuxs<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus [OPTION...] COMMAND [ARG...]</span>

<span class="tok-go">Nexus Options:</span>
<span class="tok-go"> -h, --help            Print this help message</span>
<span class="tok-go"> -o, --output-file     Print to this file instead of STDOUT</span>
<span class="tok-go"> -f, --output-format   Output format [json|mpk|voidstar]</span>

<span class="tok-go">Exported commands (call with -h/--help for more info):</span>
<span class="tok-go">  foo  Take two reals and do thing</span>
<span class="tok-go">  bar  Convert a list of reals into a thing</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More detailed information about each exported subcommand may be accessed as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>foo<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus foo ARG1 ARG2</span>

<span class="tok-go">Take two reals and do thing</span>

<span class="tok-go">Positional arguments:</span>
<span class="tok-go">  ARG1  No description given</span>
<span class="tok-go">        type: Real</span>
<span class="tok-go">  ARG2  No description given</span>
<span class="tok-go">        type: Real</span>

<span class="tok-go">Return: Real</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Docstrings may also contain tags that specify how the arguments of the exported
functions map to CLI positional or optional arguments. Here is a list of the
currently supported tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> - give the CLI subcommand a dedicated name rather than defaulting to
the Morloc function name</p>
</li>
<li>
<p><code>literal</code> - treat an argument the actual data, not a file that contains the
data, currently this is just used for strings where <code>literal: true</code> indicates
that the extra JSON quotes are not required.</p>
</li>
<li>
<p><code>unroll</code> - if <code>true</code>, then the record argument is "unrolled" into a group of optional arguments</p>
</li>
<li>
<p><code>default</code> - the default value for an argument, in JSON format</p>
</li>
<li>
<p><code>metavar</code> - the variable name used for the argument in the usage text</p>
</li>
<li>
<p><code>arg</code> - short and long labels for this argument (e.g., "-v/--verbose")</p>
</li>
<li>
<p><code>true</code> - the flag labels that toggle a boolean argument on</p>
</li>
<li>
<p><code>false</code> - the flag labels that toggle a boolean argument off</p>
</li>
<li>
<p><code>return</code> - a description of the returned data (this tag is the same as adding a description docstring to final type in a signature)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a longer example that show-cases these tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">foobar</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">foo</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">bar</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-py</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foobar.py&quot;</span>
<span class="tok-w">  </span><span class="tok-p">(</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;bar&quot;</span><span class="tok-p">)</span>

<span class="tok-c1">--&#39; config record</span>
<span class="tok-c1">--&#39; unroll: true</span>
<span class="tok-c1">--&#39; arg: --config</span>
<span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">Config</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; temporary directory</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; arg: --tmp</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; literal: true</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; default: &quot;/tmp&quot;</span>
<span class="tok-w">  </span><span class="tok-n">tmpdir</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Str</span>

<span class="tok-w">  </span><span class="tok-c1">--&#39; cache the results</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; true: --cache</span>
<span class="tok-w">  </span><span class="tok-n">cache</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Bool</span>

<span class="tok-w">  </span><span class="tok-c1">--&#39; number of threads to use</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; arg: -t/--num-threads</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; default: 1</span>
<span class="tok-w">  </span><span class="tok-n">nthreads</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span>

<span class="tok-c1">--&#39; do foo stuff</span>
<span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-ow">::</span>
<span class="tok-w">  </span><span class="tok-n">Config</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; list of integers</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; metavar: INT_LIST</span>
<span class="tok-w">  </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; sum of INT_LIST</span>
<span class="tok-w">  </span><span class="tok-n">Int</span>

<span class="tok-c1">--&#39; do bar stuff</span>
<span class="tok-c1">--&#39; return: summed values</span>
<span class="tok-n">bar</span><span class="tok-w"> </span><span class="tok-ow">::</span>
<span class="tok-w">  </span><span class="tok-c1">--&#39; unroll: false</span>
<span class="tok-w">  </span><span class="tok-n">Config</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The top-level usage statement is as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus [OPTION...] COMMAND [ARG...]</span>

<span class="tok-go">Nexus Options:</span>
<span class="tok-go"> -h, --help            Print this help message</span>
<span class="tok-go"> -o, --output-file     Print to this file instead of STDOUT</span>
<span class="tok-go"> -f, --output-format   Output format [json|mpk|voidstar]</span>

<span class="tok-go">Exported commands (call with -h/--help for more info):</span>
<span class="tok-go">  foo  do foo stuff</span>
<span class="tok-go">  bar  do bar stuff</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The dedicated usage information for <code>foo</code> can be accessed as well. Here we see
that the record <code>Config</code> has been unrolled into a group of optional arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>foo<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus foo [OPTION...] INT_LIST</span>

<span class="tok-go">do foo stuff</span>

<span class="tok-go">Positional arguments:</span>
<span class="tok-go">  INT_LIST  list of integers</span>
<span class="tok-go">            type: [Int]</span>

<span class="tok-go">Group arguments:</span>
<span class="tok-go">  Config: config record</span>
<span class="tok-go">    --config Config</span>
<span class="tok-go">        Default values for this argument group</span>
<span class="tok-go">            tmpdir :: Str</span>
<span class="tok-go">            cache :: Bool</span>
<span class="tok-go">            nthreads :: Int</span>
<span class="tok-go">    --tmp Str</span>
<span class="tok-go">        temporary directory</span>
<span class="tok-go">        type: Str</span>
<span class="tok-go">        default: &quot;/tmp&quot;</span>
<span class="tok-go">    --cache</span>
<span class="tok-go">        cache the results</span>
<span class="tok-go">        default: false</span>
<span class="tok-go">    -t Int, --num-threads Int</span>
<span class="tok-go">        number of threads to use</span>
<span class="tok-go">        type: Int</span>
<span class="tok-go">        default: 1</span>

<span class="tok-go">Return: Int</span>
<span class="tok-go">  sum of INT_LIST</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since each subcommand is a function, the return type is always the same. Unlike
in a conventional CLI program, the arguments cannot alter the return type.</p>
</div>
<div class="paragraph">
<p>The <code>bar</code> subcommand explicitly does not unroll the <code>Config</code> record:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>bar<span class="tok-w"> </span>-h
<span class="tok-go">Usage: ./nexus bar ARG1 ARG2</span>

<span class="tok-go">do bar stuff</span>

<span class="tok-go">Positional arguments:</span>
<span class="tok-go">  ARG1  config record</span>
<span class="tok-go">        type: NamRecord Config&lt;&gt;</span>
<span class="tok-go">              {</span>
<span class="tok-go">                  tmpdir :: Str</span>
<span class="tok-go">                  cache :: Bool</span>
<span class="tok-go">                  nthreads :: Int</span>
<span class="tok-go">              }</span>
<span class="tok-go">  ARG2  No description given</span>
<span class="tok-go">        type: [Int]</span>

<span class="tok-go">Return: Int</span>
<span class="tok-go">  summed values</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_composable_command_line_tools"><a class="anchor" href="#_composable_command_line_tools"></a>5.7. Composable command line tools</h3>
<div class="paragraph">
<p>Since modules can both be compiled into executable command line tools and
imported by other modules, we can naturally compose command line tools.</p>
</div>
<div class="paragraph">
<p>Here is a little Morloc script that imports a Python program that prints a calendar to STDERR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">cally</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">cal</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-py</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;cal.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;cal&quot;</span><span class="tok-p">)</span>

<span class="tok-c1">--&#39; Print a 3-month calendar and some timezones</span>
<span class="tok-n">cal</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-nb">()</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-nb">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is another Morloc tool that prints d20 rolls</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">dnd</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">d20</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-py</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;dnd.R&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;d20&quot;</span><span class="tok-p">)</span>

<span class="tok-c1">--&#39; Roll n d20 dice</span>
<span class="tok-n">d20</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can import both of these into a third module which will expose the
functions from both the calendar and dnd modules.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">toolbox</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">cal</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">d20</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">cally</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">dnd</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This final module can be compiled and will have a usage statement like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Usage: ./nexus [OPTION]... COMMAND [ARG]...

Nexus Options:
 -h, --help            Print this help message
 -o, --output-file     Print to this file instead of STDOUT
 -f, --output-format   Output format [json|mpk|voidstar]

Exported Commands:
  cal   Print a 3-month calendar and some timezones
          return: Unit
  d20   Roll n d20 dice
          param 1: Int
          return: [Int]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_user_arguments_and_outputs"><a class="anchor" href="#_user_arguments_and_outputs"></a>5.8. User arguments and outputs</h3>
<div class="paragraph">
<p>User data is passed to Morloc executables as positional arguments to the
specified function subcommand. The argument may be a literal JSON string or a
filename. For files, the format may be JSON, MessagePack, or Morloc binary (VoidStar)
format. The Morloc nexus first checks for a ".json" extension, if found, the
nexus attempts to parse the file as JSON. Next the nexus checks for a ".mpk" or
".msgpack" extension, and if found it attempts to parse the file as a
MessagePack file. If neither extension is found, it attempts to parse the file
first as Morloc binary, then as MessagePack, and finally as JSON. See the
<code>parse_cli_data_argument</code> function in <code>morloc.h</code> for details.</p>
</div>
<div class="paragraph">
<p>Passing literal JSON on the command line can be a little unintuitive since extra
quoting may be required. Here are a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># The Bash shell removes the outer quotes, so double quoting is required</span>
$<span class="tok-w"> </span>./nexus<span class="tok-w"> </span>foo<span class="tok-w"> </span><span class="tok-s1">&#39;&quot;this is a literal string&quot;&#39;</span>

<span class="tok-c1"># Single quotes are lists is fine, still need to quote inner strings</span>
$<span class="tok-w"> </span>./nexus<span class="tok-w"> </span>bar<span class="tok-w"> </span><span class="tok-s1">&#39;[&quot;asdf&quot;, &quot;df&quot;]&#39;</span>

<span class="tok-c1"># By default, output is written to JSON format</span>
$<span class="tok-w"> </span>./nexus<span class="tok-w"> </span>baz<span class="tok-w"> </span><span class="tok-m">1</span><span class="tok-w"> </span><span class="tok-m">2</span><span class="tok-w"> </span><span class="tok-m">3</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>baz.json

<span class="tok-c1"># The output can be directly read by a downstream morloc program</span>
$<span class="tok-w"> </span>./nexus<span class="tok-w"> </span>bif<span class="tok-w"> </span>baz.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Data may be written to MessagePack or VoidStar via the <code>-f</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>-f<span class="tok-w"> </span>voidstar<span class="tok-w"> </span>head<span class="tok-w"> </span><span class="tok-s1">&#39;[[&quot;some&quot;,&quot;random&quot;],[&quot;data&quot;]]&#39;</span><span class="tok-w"> </span>&gt;<span class="tok-w"> </span>data.vs
<span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>-f<span class="tok-w"> </span>json<span class="tok-w"> </span>head<span class="tok-w"> </span>data.vs<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>data.json
<span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>-f<span class="tok-w"> </span>mpk<span class="tok-w"> </span>reverse<span class="tok-w"> </span>data.json<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>data.mpk
<span class="tok-gp">$ </span>./nexus<span class="tok-w"> </span>reverse<span class="tok-w"> </span>data.mpk
<span class="tok-go">&quot;some&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The VoidStar format is the richest and is the only form that contains the schema
describing the data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_general_types_to_native_types"><a class="anchor" href="#_mapping_general_types_to_native_types"></a>5.9. Mapping general types to native types</h3>
<div class="paragraph">
<p>When a function is sourced from a foreign language, Morloc needs to know how
Morloc general types map to the function&#8217;s native types. This information is
encoded in language-specific type functions. For examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Bool</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;logical&quot;</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Bool</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;bool&quot;</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Bool</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;bool&quot;</span>

<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Int32</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;integer&quot;</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Int32</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;int&quot;</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Int32</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;uint32_t&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Language-specific types are always quoted since they may contain syntax that is
illegal in the Morloc language.</p>
</div>
<div class="paragraph">
<p>A function such as an integer addition function <code>addInt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">addInt</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int32</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int32</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Int32</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be automatically mapped to a C&#43;&#43; function with the prototype <code>int addInt(int x, int y)</code>.</p>
</div>
<div class="paragraph">
<p>Containers can be similarly mapped to native types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;list&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::vector&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>$1</code> symbol is used to represent the interpolation of the first parameter
into the native type. So the Morloc type <code>List Int32</code> would translate to
<code>std::vector&lt;uint32_t&gt;</code> in C&#43;&#43;.</p>
</div>
</div>
<div class="sect2">
<h3 id="_records"><a class="anchor" href="#_records"></a>5.10. Records</h3>
<div class="paragraph">
<p>A record is internally a named tuple. Records may map to different structures in
different languages.</p>
</div>
<div class="paragraph">
<p>A general record is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">Person</span>
<span class="tok-w">    </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Str</span>
<span class="tok-w">    </span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Concrete forms must have the same field names and field types. Since these must
be the same, they need not be specified. We only need to specify the name of the
concrete type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;dict&quot;</span>
<span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;list&quot;</span>
<span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;person_t&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In R and Python, records are typically <code>dict</code> and <code>list</code> types,
respectively. These types con contain any fields of any type. In C&#43;&#43;, records
are represented as structs; these must must be defined in the C code, as shown
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">person_t</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-p">;</span>
<span class="tok-p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Functions may be defined that act on the records, as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.R&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;incAge&quot;</span><span class="tok-w"> </span><span class="tok-kr">as</span><span class="tok-w"> </span><span class="tok-n">rinc</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;incAge&quot;</span><span class="tok-w"> </span><span class="tok-kr">as</span><span class="tok-w"> </span><span class="tok-n">pinc</span><span class="tok-p">)</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;foo.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;incAge&quot;</span><span class="tok-w"> </span><span class="tok-kr">as</span><span class="tok-w"> </span><span class="tok-n">cinc</span><span class="tok-p">)</span>

<span class="tok-c1">-- Increment the person&#39;s age</span>
<span class="tok-n">rinc</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span>
<span class="tok-n">pinc</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span>
<span class="tok-n">cinc</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Records may, like all <code>morloc</code> types, be passed freely between languages. As
shown above, records may be written in braces and their type will be inferred.</p>
</div>
<div class="paragraph">
<p>The "foo.R" file contains the function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="r"><span></span><span class="tok-n">incAge</span><span class="tok-w"> </span><span class="tok-o">&lt;-</span><span class="tok-w"> </span><span class="tok-kr">function</span><span class="tok-p">(</span><span class="tok-n">person</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">person</span><span class="tok-o">$</span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-o">&lt;-</span><span class="tok-w"> </span><span class="tok-n">person</span><span class="tok-o">$</span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-m">1</span>
<span class="tok-w">    </span><span class="tok-n">person</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No special code is needed for <code>person</code>, it is just a builtin R list. Similarly for Python:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">incAge</span><span class="tok-p">(</span><span class="tok-n">person</span><span class="tok-p">):</span>
    <span class="tok-n">person</span><span class="tok-p">[</span><span class="tok-s2">&quot;age&quot;</span><span class="tok-p">]</span> <span class="tok-o">+=</span> <span class="tok-mi">1</span>
    <span class="tok-k">return</span> <span class="tok-n">person</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>C&#43;&#43; requires a definition of a <code>person_t</code> struct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="c++"><span></span><span class="tok-k">struct</span><span class="tok-w"> </span><span class="tok-nc">person_t</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">std</span><span class="tok-o">::</span><span class="tok-n">string</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-p">;</span>
<span class="tok-p">};</span>

<span class="tok-n">person_t</span><span class="tok-w"> </span><span class="tok-nf">incAge</span><span class="tok-p">(</span><span class="tok-n">person_t</span><span class="tok-w"> </span><span class="tok-n">person</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">person</span><span class="tok-p">.</span><span class="tok-n">age</span><span class="tok-o">++</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">person</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Records may be initialized and functions called on them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-n">age</span>
<span class="tok-w">    </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">rinc</span><span class="tok-w"> </span><span class="tok-err">.</span><span class="tok-w"> </span><span class="tok-n">pinc</span><span class="tok-w"> </span><span class="tok-err">.</span><span class="tok-w"> </span><span class="tok-n">cinc</span><span class="tok-p">)</span>
<span class="tok-w">      </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>foo</code>, above, initializes a <code>Person</code> record and then increments its age 3 time
in different languages.</p>
</div>
<div class="paragraph">
<p>Records may contain fields with arbitrarily complex types, but recursive types
are currently not supported. They will be in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tables"><a class="anchor" href="#_tables"></a>5.11. Tables</h3>
<div class="paragraph">
<p>Tables are similar, but all fields are lists of equal length:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">module</span><span class="tok-w"> </span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">readPeople</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">addPeople</span><span class="tok-p">)</span>

<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-py</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Int</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Str</span><span class="tok-p">)</span>

<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;people-tables.R&quot;</span>
<span class="tok-w">   </span><span class="tok-p">(</span><span class="tok-w"> </span><span class="tok-s">&quot;read.delim&quot;</span><span class="tok-w"> </span><span class="tok-kr">as</span><span class="tok-w"> </span><span class="tok-n">readPeople</span>
<span class="tok-w">   </span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;addPeople&quot;</span><span class="tok-p">)</span>

<span class="tok-kr">table</span><span class="tok-w"> </span><span class="tok-n">People</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">People</span>
<span class="tok-w">    </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Str</span>
<span class="tok-w">    </span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-n">readPeople</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Filename</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">People</span>
<span class="tok-n">addPeople</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Str</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Int</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">People</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">People</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With "people-tables.R" containing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="r"><span></span><span class="tok-n">addPeople</span><span class="tok-w"> </span><span class="tok-o">&lt;-</span><span class="tok-w"> </span><span class="tok-kr">function</span><span class="tok-p">(</span><span class="tok-n">names</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ages</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">df</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-nf">rbind</span><span class="tok-p">(</span><span class="tok-n">df</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nf">data.frame</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">names</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ages</span><span class="tok-p">))</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be compiled and run as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># read a tab-delimited file containing person rows</span>
./nexus<span class="tok-w"> </span>readPeople<span class="tok-w"> </span>data.tab<span class="tok-w"> </span>&gt;<span class="tok-w"> </span>people.json

<span class="tok-c1"># add a row to the table</span>
./nexus<span class="tok-w"> </span>addPeople<span class="tok-w"> </span><span class="tok-s1">&#39;[&quot;Eve&quot;]&#39;</span><span class="tok-w"> </span><span class="tok-s1">&#39;[99]&#39;</span><span class="tok-w"> </span>people.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The record and table types are currently excessively strict. Defining functions
that add or remove fields/columns requires defining entirely new
records/tables. Generic funtions for operations such as removing lists of
columns cannot be defined at all. Future versions of Morloc will have more
flexible tables, but for now most operations should be done in coarser
functions. Alternatively, custom non-parameterized tabular/record types may be
defined.</p>
</div>
<div class="paragraph">
<p>The case study in the Morloc
<a href="https://www.zebulun-arendsee.com/images/morloc-paper-001.pdf">paper</a> uses a
<code>JsonObj</code> type that represents an arbitrarily nested object that serializes
to/from JSON. In Python, it deserializes to a <code>dict</code> object; in R, to a <code>list</code>
objects; and in C to an <code>ordered_json</code> object from from
(<a href="https://github.com/nlohmann)">Niels Lohmann&#8217;s json package</a>).</p>
</div>
<div class="paragraph">
<p>A similar approach could be used to define a non-parameterized table type that
serialized to CSV or some binary type (such as Parquet).</p>
</div>
<div class="paragraph">
<p>These non-parameterized solutions are flexible and easy to use, but lack the
reliability of the typed structures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_hierarchies"><a class="anchor" href="#_type_hierarchies"></a>5.12. Type hierarchies</h3>
<div class="paragraph">
<p>In some cases, there is a single obvious native type for a given Morloc general
type. For example, most languages have exactly only one reasonable way to
represent a boolean. However, other data types have may have many forms. The
Morloc <code>List</code> is a simple example. In Python, the <code>list</code> type is most often used
for representing ordered lists, however it is inefficient for heavy numeric
problems. In such cases, it is better to use a <code>numpy</code> vector. Further, there
are data structures that are isomorphic to lists but that are more efficient for
certain problems, such as stacks and queues.</p>
</div>
<div class="paragraph">
<p>We can define type hierarchies that represent these relationships.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-c1">-- aliases at the general level</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Stack</span><span class="tok-w">       </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">LList</span><span class="tok-w">       </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">ForwardList</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Deque</span><span class="tok-w">       </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Queue</span><span class="tok-w">       </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Vector</span><span class="tok-w">      </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-n">a</span>


<span class="tok-c1">-- define a C++ specialization for each special type</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Stack</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::stack&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">LList</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::list&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">ForwardList</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::forward_list&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Deque</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::deque&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Queue</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::queue&lt;$1&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we equate each of the specialized containers with the general <code>List</code>
type. This indicates that they all share the same common form and can all be
converted to the same binary. Then we specify language specific patterns as
desired. When the Morloc compiler seeks a native form for a type, it will
evaluate these type functions by incremental steps. At each step the compiler
first checks to see if there is a direct native mapping for the language, if
none is found, it evaluates the general type function.</p>
</div>
<div class="paragraph">
<p>Native type annotations are also passed to the language binders, allowing them
to implement specialized behavior for more efficient conversion to binary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_one_term_may_have_many_definitions"><a class="anchor" href="#_one_term_may_have_many_definitions"></a>5.13. One term may have many definitions</h3>
<div class="paragraph">
<p>Morloc supports what might be called <em>term polymorphism</em>. Each
term may have many definitions. For example, the function <code>mean</code> has three
definitions below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">base</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sum</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">div</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">size</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fold</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">add</span><span class="tok-p">)</span>
<span class="tok-kr">import</span><span class="tok-w"> </span><span class="tok-n">root-cpp</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;mean.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;mean&quot;</span><span class="tok-p">)</span>
<span class="tok-n">mean</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-n">Real</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">Real</span>
<span class="tok-n">mean</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">div</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">size</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span>
<span class="tok-n">mean</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">div</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">fold</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-w"> </span><span class="tok-n">add</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">size</span><span class="tok-w"> </span><span class="tok-n">xs</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mean</code> is sourced directly from C&#43;&#43;, it is defined in terms of the <code>sum</code>
function, and it is defined more generally with <code>sum</code> written as a fold
operation. The Morloc compiler is responsible for deciding which
implementation to use.</p>
</div>
<div class="paragraph">
<p>The equals operator in Morloc indicates functional substitutability. When you
say a term is "equal" to something, you are giving the compiler an option for
what may be substituted for the term. The function <code>mean</code>, for example, has many
functionally equivalent definitions. They may be in different languages, or they
may be more optimal in different situations.</p>
</div>
<div class="paragraph">
<p>Now this ability to simply state that two things are the same can be abused. The
following statement is syntactically allowed in Morloc:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">1</span>
<span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is <code>x</code> after this code is run? It is 1 <em>or</em> 2. The latter definition does
not mask the former, it <em>appends</em> the former. Now in this case, the two values
are certainly not substitutable. Morloc has a simple <em>value checker</em> that will
catch this type of primitive contradition. However, the value checker cannot yet
catch more nuanced errors, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">div</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">add</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span>
<span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">div</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-w"> </span><span class="tok-mi">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the type checker cannot check whithin the implementation of <code>add</code>,
so it cannot know that there is a contradiction. For this reason, some care is
needed in making these definitions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overload_terms_with_typeclasses"><a class="anchor" href="#_overload_terms_with_typeclasses"></a>5.14. Overload terms with typeclasses</h3>
<div class="paragraph">
<p>In addition to term polymorphism, Morloc offers more traditional ad hoc
polymorphism over types. Here typeclasses may be defined and type-specific
instances may be given. This idea is similar to typeclasses in Haskell, traits
in Rust, interfaces in Java, and concepts in C&#43;&#43;.</p>
</div>
<div class="paragraph">
<p>In the example below, <code>Addable</code> and <code>Foldable</code> classes are defined and used to
create a polymorphic <code>sum</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">class</span><span class="tok-w"> </span><span class="tok-n">Addable</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-n">zero</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-w">    </span><span class="tok-n">add</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span>

<span class="tok-kr">instance</span><span class="tok-w"> </span><span class="tok-n">Addable</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-s">&quot;arithmetic.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;add&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-s">&quot;arithmetic.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;add&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-n">zero</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">0</span>

<span class="tok-kr">instance</span><span class="tok-w"> </span><span class="tok-n">Addable</span><span class="tok-w"> </span><span class="tok-n">Real</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-s">&quot;arithmetic.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;add&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-s">&quot;arithmetic.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;add&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-n">zero</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mf">0.0</span>

<span class="tok-kr">class</span><span class="tok-w"> </span><span class="tok-n">Foldable</span><span class="tok-w"> </span><span class="tok-n">f</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-n">foldr</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">f</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span>

<span class="tok-kr">instance</span><span class="tok-w"> </span><span class="tok-n">Foldable</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-s">&quot;foldable.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;foldr&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-s">&quot;foldable.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;foldr&quot;</span><span class="tok-p">)</span>

<span class="tok-n">sum</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">foldr</span><span class="tok-w"> </span><span class="tok-n">add</span><span class="tok-w"> </span><span class="tok-n">zero</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The instances may import implementations for many languages.</p>
</div>
<div class="paragraph">
<p>The native functions may themselves be polymorphic, so the imported
implementations may be repeated across many instances. For example, the Python
<code>add</code> may be written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-k">def</span><span class="tok-w"> </span><span class="tok-nf">add</span><span class="tok-p">(</span><span class="tok-n">x</span><span class="tok-p">,</span> <span class="tok-n">y</span><span class="tok-p">):</span>
    <span class="tok-k">return</span> <span class="tok-n">x</span> <span class="tok-o">+</span> <span class="tok-n">y</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the C&#43;&#43; add as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cpp"><span></span><span class="tok-k">template</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-k">class</span><span class="tok-w"> </span><span class="tok-nc">A</span><span class="tok-o">&gt;</span>
<span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">add</span><span class="tok-p">(</span><span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">A</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">x</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">y</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typeclasses work currently, but they are not yet in their final form. They
cannot be directly imported and they are not explicit in type signatures. I
would be happy to hear your thoughts on Morloc typeclasses. Getting them right
is crucial to the grand structure of the future Morloc library.</p>
</div>
</div>
<div class="sect2">
<h3 id="_binary_forms"><a class="anchor" href="#_binary_forms"></a>5.15. Binary forms</h3>
<div class="paragraph">
<p>Every Morloc general type maps unambiguously to a binary form that consists of
several fixed-width literal types, a list container, and a tuple container. The
literal types include a unit type, a boolean, signed integers (8, 16, 32, and 64
bit), unsigned integers (8, 16, 32, and 64 bit), and IEEE floats (32 and 64 bit). The
list container is represented by a 64-bit size integer and a pointer to an
unboxed vector. The tuple is represented as a set of values in contiguous
memory. These basic types are listed below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Morloc primitives</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Domain</th>
<th class="tableblock halign-left valign-top">Schema</th>
<th class="tableblock halign-left valign-top">Width (bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">z</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code> | <code>False</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([0,2^{8})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([0,2^{16})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([0,2^{32})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UInt64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([0,2^{64})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([-2^{7},2^{7})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([-2^{15},2^{15})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([-2^{31},2^{31})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\([-2^{63},2^{63})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">f4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">f8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">het lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a{x}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(16 + n \Vert a \Vert \)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tuple2 x1 x2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-ples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">t2{x1}{x2}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\Vert a \Vert + \Vert b \Vert\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TupleX \(\ t_i\ ...\ t_k\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">k-ples</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(tkt_1\ ...\ t_k\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\sum_i^k \Vert t_i \Vert\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\{ f_1 :: t_1,\ ... \ , f_k :: t_k \}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">records</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(mk \Vert f_1 \Vert f_1 t_1\ ...\ \Vert f_k \Vert f_k t_k \)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\sum_i^k \Vert t_i \Vert\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All basic types may be written to a schema that is used internally to direct
conversions between Morloc binary and native basic types. The schema values
are shown in the table above. For example, the type <code>[(Bool, [Int8])]</code> would
have the schema <code>at2bai1</code>. You will not usually have to worry about these
schemas, since they are mostly used internally. They are worth knowing, though,
since they appear in low-level tests, generated source code, and binary data
packets.</p>
</div>
<div class="paragraph">
<p>Here is an example of how the type <code>([UInt8], Bool)</code>, with the value
<code>([3,4,5],True)</code>,  might be laid out in memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>---
03 00 00 00 00 00 00 00 00 -- first tuple element, specifies list length (little-endian)
30 00 00 00 00 00 00 00 00 -- first tuple element, pointer to list
01 00 00 00 00 00 00 00 00 -- second tuple element, with 0-padding
03 04 05                   -- 8-bit values of 3, 4, and 5
---</code></pre>
</div>
</div>
<div class="paragraph">
<p>Records and tables are represented as tuples. The names for each field are stored only in
the type schemas. Morloc also supports tables, which are just records where
the field types correspond to the column types and where fields are all
equal-length lists. Records and tables may be defined as shown below:</p>
</div>
<div class="paragraph">
<p>A <code>record</code> is a named, heterogenous list such as a <code>struct</code> in C, a <code>dict</code> in
Python, or a <code>list</code> in R. The type of the record exactly describes the data
stored in the record (in contrast to parameterized types like <code>[a]</code> or <code>Map a
b</code>). They are represented in Morloc binary as tuples, the keys are only stored
in the schemas.</p>
</div>
<div class="paragraph">
<p>A <code>table</code> is like a record where field types represent the column types. But
<code>table</code> is not just syntactic sugar for a record of lists, the <code>table</code>
annotation is passed with the record through the compiler all the way to the
translator, where the language-specific serialization functions may have special
handling for tables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">record</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">Person</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">UInt8</span><span class="tok-w"> </span><span class="tok-p">}</span>
<span class="tok-kr">table</span><span class="tok-w"> </span><span class="tok-n">People</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-n">People</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Str</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">Int</span><span class="tok-w"> </span><span class="tok-p">}</span>

<span class="tok-n">alice</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;Alice&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-mi">27</span><span class="tok-w"> </span><span class="tok-p">}</span>
<span class="tok-n">students</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-s">&quot;Alice&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;Bob&quot;</span><span class="tok-p">],</span><span class="tok-w"> </span><span class="tok-n">age</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-mi">27</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">25</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Morloc type signatures can be translated to schema strings that may be
parsed by a foundational Morloc C library into a type structure. Every
supported language in the Morloc ecosystem must provide a library that wraps
this Morloc C library and translates to/from Morloc binary given the
Morloc type schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="_defining_non_primitive_types"><a class="anchor" href="#_defining_non_primitive_types"></a>5.16. Defining non-primitive types</h3>
<div class="paragraph">
<p>Types that are composed entirely of Morloc primitives, lists, tuples, records
and tables may be directly and unambiguously translated to Morloc binary forms
and thus shared between languages. But what about types that do not break down
cleanly into these forms? For example, consider the parameterized <code>Map k v</code> type
that represents a collection with keys of generic type <code>k</code> and values of generic
type <code>v</code>. This type may have many representations, including a list of pairs, a
pair of columns, a binary tree, and a hashmap. In order for Morloc to know how
to convert all <code>Map</code> types in all languages to one form, it must know how to
express <code>Map</code> type in terms of more primitive types. The user can provide this
information by defining instances of the <code>Packable</code> typeclass for <code>Map</code>. This
typeclass defines two functions, <code>pack</code> and <code>unpack</code>, that construct and
deconstruct a complex type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">class</span><span class="tok-w"> </span><span class="tok-n">Packable</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-n">pack</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">b</span>
<span class="tok-w">    </span><span class="tok-n">unpack</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Map</code> type for Python and C&#43;&#43; may be defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;dict&quot;</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span>
<span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;std::map&lt;$1,$2&gt;&quot;</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span>
<span class="tok-kr">instance</span><span class="tok-w"> </span><span class="tok-n">Packable</span><span class="tok-w"> </span><span class="tok-p">([</span><span class="tok-n">a</span><span class="tok-p">],[</span><span class="tok-n">b</span><span class="tok-p">])</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Map</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Cpp</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;map-packing.hpp&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;pack&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;unpack&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">Py</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;map-packing.py&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;pack&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;unpack&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Morloc user never needs to directly apply the <code>pack</code> and <code>unpack</code>
functions. Rather, these are used by the compiler within the generated code. The
compiler constructs a serialization tree from the general type and from this
trees generates the native code needed to (un)pack types recursively until only
primitive types remain. These may then be directly translated to Morloc binary
using the language-specific binding libraries.</p>
</div>
<div class="paragraph">
<p>In some cases, the native type may not be as generic as the general type. Or you
may want to add specialized (un)packers. In such cases, you can define more
specialized instances of <code>Packable</code>. For example, if the <code>R</code> <code>Map</code> type is
defined as an <code>R</code> list, then keys can only be strings. Any other type should
raise an error. So we can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-kr">type</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-ow">=&gt;</span><span class="tok-w"> </span><span class="tok-n">Map</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span><span class="tok-w"> </span><span class="tok-ow">=</span><span class="tok-w"> </span><span class="tok-s">&quot;list&quot;</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-n">val</span>
<span class="tok-kr">instance</span><span class="tok-w"> </span><span class="tok-n">Packable</span><span class="tok-w"> </span><span class="tok-p">([</span><span class="tok-n">Str</span><span class="tok-p">],[</span><span class="tok-n">b</span><span class="tok-p">])</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Map</span><span class="tok-w"> </span><span class="tok-n">Str</span><span class="tok-w"> </span><span class="tok-n">b</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kr">where</span>
<span class="tok-kr">source</span><span class="tok-w"> </span><span class="tok-n">R</span><span class="tok-w"> </span><span class="tok-kr">from</span><span class="tok-w"> </span><span class="tok-s">&quot;map-packing.R&quot;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;pack&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;unpack&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now whenever the key generic type of <code>Map</code> is inferred to be anything other than
a string, all R implementations will be pruned.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ecosystem"><a class="anchor" href="#_ecosystem"></a>6. Ecosystem</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_universal_library"><a class="anchor" href="#_the_universal_library"></a>6.1. The universal library</h3>
<div class="paragraph">
<p>A module may export types, typeclasses, and function signatures but no
implementations. Such a module would be completely language agnostic. A powerful
approach to building libraries in the Morloc ecosystem is to write one module
that defines all types, then $n$ modules for language-specific implementations
that import the type module, and then one module to import and merge all
implementations. This is the approach taken by the <code>base</code> module and by other
core libraries.</p>
</div>
<div class="paragraph">
<p>In the future, when hundreds of languages are supported, and when possibly some
functions may even have many implementations per language, it will be desirable
to have finer control over what functions are used. One solution would be to add
filters to the import statement. Thus the import expressions would be a sort of
query. Alternatively, constraints could be added at the function level, and thus
the entire Morloc script would be a query over the universal library. This would
be especially powerful when imported types are expressed as unknowns to be
inferred by usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_planes_of_libraries"><a class="anchor" href="#_planes_of_libraries"></a>6.2. Planes of libraries</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img loading="lazy" src="static/img/admonition_icons/important.png" alt="Important">
</td>
<td class="content">
The infrastructure for "planes" is not yet constructed, so the following is speculative
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The concept of "planes" is central to the future organization of Morloc and is
one of the primary reasons that I created it. A <strong>plane</strong> is like a namespace for
a community&#8217;s modules&#8212;&#8203;but instead of organizing by category or programming
language, modules in a plane share a common philosophy about quality,
trustworthiness, software design and the review process.</p>
</div>
<div class="paragraph">
<p>Currently, the universe of functions is separated first by language and then by subject
area. Morloc, being polyglot, allows the first mode of separation to be lifted,
so language does not need to separate communities. Instead, communities can
organize around <strong>values</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Levels of review &amp; trust:</strong> Code may be wild and experimental; tightly reviewed and trusted in production; or formally verified.</p>
</li>
<li>
<p><strong>Design philosophy:</strong> Groups may prioritize safety, raw performance, or elegance by some metric.</p>
</li>
<li>
<p><strong>Use case:</strong> Planes may focus on production, pedagogy, competition or experimentation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Making these differences explicit (and easy to navigate) lets the community set and find their own standards.</p>
</div>
<div class="paragraph">
<p><strong>Real-World Analogs</strong></p>
</div>
<div class="paragraph">
<p>Within the R community, you could define three planes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CRAN:</strong> Has stringent requirements for acceptance and manual application process focused on adherence to well-defined (mostly automated) requirements</p>
</li>
<li>
<p><strong>rOpenSci:</strong> Focuses on a formal peer review process that considers motivation, documentation, and good software design</p>
</li>
<li>
<p><strong>GitHub:</strong> Wild west. Anything goes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You could probably find more "planes" in R, but these three capture the idea of
what a plane is. It is a design philosophy and set of protocols that define
admission.</p>
</div>
<div class="paragraph">
<p><strong>Possible examples of Morloc planes</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>unstable</strong>: For newly submitted or unvetted modules, e.g., loaded straight from GitHub.</p>
</li>
<li>
<p><strong>safe</strong>: Modules that passed manual review, rigorous automated tests, and have strong test suites.</p>
</li>
<li>
<p><strong>true</strong>: For formally verified code, strict on what languages are allowed (e.g., dependently typed languages).</p>
</li>
<li>
<p><strong>prod</strong>: For modules ready for production, combining safety and performance.</p>
</li>
<li>
<p><strong>comp</strong>: Modules suited for competitive programming; all performance, no safety checks or focus on software design principles.</p>
</li>
<li>
<p><strong>red</strong>: Adversarial modules&#8212;&#8203;written to give the Morloc bot problems. Probably don&#8217;t want to import these.</p>
</li>
<li>
<p><strong>weird</strong>: Esoteric code. For silly implementations that abuse languages in fun ways.</p>
</li>
<li>
<p><strong>demo</strong>: Prototypes, examples, and proof-of-concept modules. More pedogogical than practical.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Planes aren’t rigid categories, but cultures: each has its own ground rules,
review process, and ideas about what makes code "good". Anyone can propose a new
plane, but we don’t want too many; a bit of consensus is required before adding
one.</p>
</div>
<div class="paragraph">
<p><strong>How Does a Module Join a Plane?</strong></p>
</div>
<div class="paragraph">
<p>Again, the architecture is in development. But here is the basic process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Register:</strong> Authors register their module (e.g., import code from GitHub and authenticate).</p>
</li>
<li>
<p><strong>AI Vetting:</strong> Our AI (Weena) checks code for basic standards.</p>
</li>
<li>
<p><strong>Acceptance:</strong> After being accepted, the module defaults to the <code>unstable</code> plane.</p>
</li>
<li>
<p><strong>Level Up:</strong> Module authors can then apply to join other planes. Getting accepted depends on the plane’s review process (could be peer review, automated testing, thumbs up from community members, or nothing at all).</p>
</li>
<li>
<p><strong>Multiple Planes:</strong> Modules can exist in multiple planes at once&#8212;&#8203;different communities may trust the same code for different reasons.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This process will eventually be mediated on the website morloc.io (under construction).</p>
</div>
<div class="paragraph">
<p>Overall, planes help you find code that matches your needs and values&#8212;&#8203;whether
you want ultimate safety, bleeding-edge performance, or just something weird
that might surprise you. They also provide community and allow relations between
different codebases to be specified.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internals"><a class="anchor" href="#_internals"></a>7. Internals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_packet_protocols"><a class="anchor" href="#_packet_protocols"></a>7.1. Packet protocols</h3>
<div class="paragraph">
<p>A Morloc program compiles into a single "nexus" file and a "pool" file for each
language. The nexus program accepts user input, dispatches to the pools, and
formats results. The pools "pool" all functions from each specific
language. When a command is sent to the nexus, it initializes the pools as
background processes, pool daemons. Then the nexus sends the given information
to the pool daemon that contains the top function in the composition.</p>
</div>
<div class="paragraph">
<p>Data is passed between the nexus and between daemons using a combination of UNIX
domain socket messages and shared memory storage.</p>
</div>
<div class="paragraph">
<p>Packets follow a binary protocol that is defined in the <code>data/morloc.h</code> file in
the main Morloc repository.</p>
</div>
<div class="paragraph">
<p>Each packet has a 32-byte header with the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Packet header specification</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>magic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Morloc-specific constant: 6D F8 07 07 (mo-ding-ding)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Morloc "plain" (see below for description)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packet version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flavor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata convention</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Evaluation mode (e.g., debug or verbose)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-byte union</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packet description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">length of metadata block</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">length of the data payload</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img loading="lazy" src="static/img/diag-mermaid-md5-b16fa2e1522cf5c27c35b08f3cf4bccd.svg" alt="Diagram" width="1026" height="62">
</div>
</div>
<div class="paragraph">
<p>The Morloc plain specifies membership in a special set of Morloc libraries that
follows a certain set of conventions of requirements. This is broader than a
namespace. An example of a plain would be a "Safe" plain where all functions are
verified in some fashion. In this case, it may be required that any packets that
are read into a program should also have been created by a member of the Safe
plain. Handling for plains is not yet implemented.</p>
</div>
<div class="paragraph">
<p>The <code>command</code> specifies the type of packet. There are currently three: <code>data</code>,
<code>call</code>, and <code>ping</code>.</p>
</div>
<div class="paragraph">
<p>A data packet represents data and how it is stored. These packets have three
main uses. First, they are used to store arguments that are passed between the
nexus and pool daemons. Second, they are transport data within the pools that
has not been transformed into native structures. This allows data to be
efficiently transferred between languages without being "naturalized" unless
needed. Third, data packets may be written by the nexus as the output of a
program.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Data packet command field specification</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant 0 - for "data" type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source type (e.g., file, message, pointer to shared memory)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data format (e.g., JSON, MessagePack, Text, Voidstar)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compresssion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compression algorithm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encryption</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encryption algorithm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass or fail status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>padding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[2]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero-padding</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>source</code> field states "where" the data is. It might be stored literally in
the packet itself. It might be stored in a file, in which case the packet stores
only the filename. It might be stored in the shared memory volumes, in which
case the packet stores a relative pointer to the memory location. The <code>format</code>
field stores the data type. It might be JSON data, MessagePack data, literal
text (e.g., for error messages), or the Morloc binary (which I sometimes call
Voidstar). The <code>compression</code> and <code>encryption</code> fields are not currently used. But
in the future they will be needed to support packet-specific
compression/encryption of payloads. The <code>status</code> field represents whether the
producing computation failed. If so, then the packet may contain an error
message.</p>
</div>
<div class="paragraph">
<p>A call packet is sent from the nexus to a pool daemon or between daemons (for
foreign calls). These packets specify the function to call and contain a
contiguous list of data packets representing positional arguments as their
payload.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Call packet command field specification</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant 1 - for "call" type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entrypoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stores if the call is local or remote (or something else)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>padding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[2]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero-padding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>midx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID for the function to call in the pool daemon</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>entrypoint</code> field is currently used when a call packet is sent to a remote
machine for execution.</p>
</div>
<div class="paragraph">
<p>A ping packet is a header-only packet that is sent to check if some resource
(such as a pool daemon) is up and running. The nexus will ping all pool daemons
until it gets a response before sending them call instructions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Ping packet command field specification</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant 2 - for "ping" type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>padding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[7]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 padding</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Metadata is stored in blocks that start with an 8-byte metadata header.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Metadata block specification</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>magic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char[3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant "mmh" string (Morloc Metadata Header)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata type (e.g., schema string or data hash)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data format (e.g., JSON, MessagePack, Text, Voidstar)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Currently Morloc uses the metadata section to store data type schemas and to
cache data hashes. In the future, these sections could be extended to store
provenance data, benchmark data, environment info, runtime dags, or even raw
inputs and code. The nexus can write data packets as a final output.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_qa"><a class="anchor" href="#_qa"></a>8. Q&amp;A</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_i_only_use_one_language_is_morloc_still_useful"><a class="anchor" href="#_i_only_use_one_language_is_morloc_still_useful"></a>8.1. I only use one language, is Morloc still useful?</h3>
<div class="paragraph">
<p>Yes, Morloc remains useful even if you only use one programming language.</p>
</div>
<div class="paragraph">
<p>While Morloc is designed to allow polyglot development, its core benefits also
apply to single-language projects. In the Morloc ecosystem, you may continue
working in your preferred language, but focus shifts to writing libraries
instead of standalone applications.</p>
</div>
<div class="paragraph">
<p>Morloc lets you compose these functions and automatically generate applications
from them, offering several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Broader usability</strong>: Your functions can be easily reused and easily accessed
by other language communities.</p>
</li>
<li>
<p><strong>Improved testing and benchmarking</strong>: Functions can be integrated into
language-agnostic testing and benchmarking frameworks.</p>
</li>
<li>
<p><strong>Future-proofing</strong>: If you ever need to migrate to a new language, Morloc’s
type annotations and documentation carry over—only the implementation needs
to change. And if you want to leave the Morloc ecosystem, your implementation
does not need to change.</p>
</li>
<li>
<p><strong>Better workflows</strong>: Especially in fields like bioinformatics, Morloc shifts
workflows from chaining applications and files to composing typed functions
and native data structures, making pipelines more robust and easier to
validate.</p>
</li>
<li>
<p><strong>No more format parsing</strong>: Morloc data structures replace bespoke file formats
and offer efficient serialization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While language interop is a major feature of Morloc, it is not main purpose. The
very first version of Morloc was not even polyglot at all. The focus originally
was to just have a simple composition language that separated pure code from
associated effects, conditions, caching, etc.</p>
</div>
<div class="paragraph">
<p>The primary goal of Morloc is to support the development of composable, typed
universal libraries. Support for many languages is required for this goal, since
no one language is best for all cases. Most Morloc users would continue to
program in their favorite language, but gain the ability to compose, share, and
extend functionality more easily.</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_this_just_a_bioinformatics_workflow_language"><a class="anchor" href="#_is_this_just_a_bioinformatics_workflow_language"></a>8.2. Is this just a bioinformatics workflow language?</h3>
<div class="paragraph">
<p>No. The Morloc paper
<a href="https://www.zebulun-arendsee.com/images/morloc-paper-001.pdf">pre-released here</a>,
is focused on bioinformatics applications. As discussed at length in the paper,
Morloc addresses systematic flaws in the traditional approaches to building
bioinformatics workflows. Given the need, and also given my personal background,
bioinformatics is a good place to start. However, Morloc can be more broadly
applied to any functional problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_you_really_want_to_deprecate_all_the_bioinformatics_formats"><a class="anchor" href="#_do_you_really_want_to_deprecate_all_the_bioinformatics_formats"></a>8.3. Do you really want to deprecate all the bioinformatics formats?</h3>
<div class="paragraph">
<p>Yes, with the possible exception of a specialized binary formats which may offer
performance benefits.</p>
</div>
<div class="paragraph">
<p>For human-readable semi-structured formats, I think only two are necessary. A
tabular format (e.g., CSV) and a tree format (e.g., JSON).</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_you_really_want_to_deprecate_all_the_bioinformatics_applications"><a class="anchor" href="#_do_you_really_want_to_deprecate_all_the_bioinformatics_applications"></a>8.4. Do you really want to deprecate all the bioinformatics applications?</h3>
<div class="paragraph">
<p>Yes, with the exception of interactive graphical applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_you_want_to_deprecate_the_conventional_workflow_languages"><a class="anchor" href="#_do_you_want_to_deprecate_the_conventional_workflow_languages"></a>8.5. Do you want to deprecate the conventional workflow languages?</h3>
<div class="paragraph">
<p>Not entirely. They do offer good scaling support that Morloc cannot yet
match. Some also support GUIs which offer an intuitive and valuable way to
visualize and create workflows from coarse components.</p>
</div>
<div class="paragraph">
<p>Hybrid solutions are possible. Conventional workflow languages can wrap Morloc
compiled applications and pass Morloc generated data in place of bespoke
bioinformatics formats.</p>
</div>
</div>
<div class="sect2">
<h3 id="_does_morloc_allow_function_specific_environments"><a class="anchor" href="#_does_morloc_allow_function_specific_environments"></a>8.6. Does Morloc allow function-specific environments?</h3>
<div class="paragraph">
<p>No, unlike workflow managers such as Snakemake and Nextflow, Morloc does not
offer function-specific environments. This is a deliberate design choice.</p>
</div>
<div class="paragraph">
<p>Dependency resolution is a hard and heavily researched problem. The general goal
of dependency solvers is to find <strong>one</strong> set of dependencies that satisfies the
<strong>entire</strong> program. The bioinformatics community often gives up on finding unified
environments and instead runs each function in its independent environment. With
every function running in its own container, all dependency issues are
encapsulated and all functions may be executed from one manager. But this comes
at a heavy cost. Each application must be wrapped in a script, the script must
be executed via an expensive system call into the container, and data must be
serialized and sent to the container. This approach is reasonable for workflows
with a small number of heavy components. But from a programming language
perspective, wrapping every function call in its own environment is inefficient
and opaque.</p>
</div>
<div class="paragraph">
<p>Morloc is designed not to hide problems in boxes, but rather to solve the root
problem. Conventional workflow languages attempt to simplify workflows design by
layering frameworks over the functions. The Morloc approach is the exact
opposite. First delete everything unnecessary from all applications and lift
their light algorithmic cores into clean, well-typed libraries. Then build
upwards through composition of these pure functions&#8212;&#8203;and judicious use of
impure ones&#8212;&#8203;to create efficient, reliable, and composable tools.</p>
</div>
<div class="paragraph">
<p>Now, if you really do need to run something in a container, you can just make a
function that wraps a call to a container and then use it just as you would any
other function. You could even write a wrapper function that takes a record with
all the metadata needed for a conda environment and execute its function within
that environment. We can do this through libraries, so there is no need to
hardcode this pattern into the Morloc language itself.</p>
</div>
<div class="paragraph">
<p>The reproducibility of Morloc workflows may be ensured by running the entire
Morloc program in an environment or container, with a single set of
dependencies. The specific Morloc compiler version can be specified and modules
may be imported using their git hashes. This is done in the current Morloc
examples (see the Dockerfile in the workflow-comparisons folder of
<a href="https://github.com/morloc-project/examples" class="bare">https://github.com/morloc-project/examples</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_about_recursion"><a class="anchor" href="#_what_about_recursion"></a>8.7. What about recursion?</h3>
<div class="paragraph">
<p>Recursion is <strong>not</strong> directly supported in Morloc. It may be in the future, but
the implementation is complicated by inconsistent support for recursion in
different languages. For example, Python has a recursion limit that can cause
runtime crashes. Instead, recursive algorithms should be written as control
fucntions in foreign languages.</p>
</div>
<div class="paragraph">
<p>For example, the Morloc <code>bio</code> module contains many generic tree traversal
algorithms. One is the <code>foldTree</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="morloc"><span></span><span class="tok-n">foldTree</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-n">l</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-w">  </span><span class="tok-ow">::</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">l</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-w"> </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span><span class="tok-p">)</span>
<span class="tok-w">  </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span>
<span class="tok-w">  </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">RootedTree</span><span class="tok-w"> </span><span class="tok-n">n</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-n">l</span>
<span class="tok-w">  </span><span class="tok-ow">-&gt;</span><span class="tok-w"> </span><span class="tok-n">a</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the <code>RootedTree</code> type represents a phylogenetic tree with generic node
(<code>n</code>), edge (<code>e</code>), and leaf (<code>l</code>) types. The <code>foldTree</code> function accepts two
functions as arguments. The first <code>(l &#8594; a &#8594; a)</code>, reduces leaf values to the
accumulator value. The second, reduces branch given the parent node, edge and
current accumulator value. The strategy for implementing this function is
decided in the foreign source code. The current C&#43;&#43; implementation is
recursive, but iterative alternatives are possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_about_object_oriented_programming"><a class="anchor" href="#_what_about_object_oriented_programming"></a>8.8. What about object-oriented programming?</h3>
<div class="paragraph">
<p>An "object" is a somewhat loaded term in the programming world. As far as
Morloc is concerned, an object is a thing that contains data and possibly
other unknown stuff, such as hidden fields and methods. All types in Morloc
have must forms that are transferable between languages. Methods do not easily
transfer; at least they cannot be written to Morloc binary. However, it is
possible to convey class-like APIs through typeclasses. Hidden fields are more
challenging since, by design, they are not accessible. So objects cannot
generally be directly represented in the Morloc ecosystem.</p>
</div>
<div class="paragraph">
<p>Objects that have a clear "plain old data" representation can be handled by
Morloc. These objects, and their component types, must have no vital hidden
data, no vital state, and no required methods. Examples of these are all the
basic Python types (<code>int</code>, <code>float</code>, <code>list</code>, <code>dict</code>, etc) and many C&#43;&#43; types such
as the standard vector and tuple types. When these objects are passed between
languages, they are reduced to their pure data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_is_morloc_still_relevant_when_ai_can_program_and_translate"><a class="anchor" href="#_is_morloc_still_relevant_when_ai_can_program_and_translate"></a>8.9. Is Morloc still relevant when AI can program and translate?</h3>
<div class="paragraph">
<p><em>Maybe</em>. Morloc may serve as a system for functional composition, verification,
and automation even when most functions are generated by machines.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll lay out an argument for this below, starting with a few proposition:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Adversaries exist</strong>. AIs may themselves be adversarial or there might be
adversarial code in ecosystem around the AIs (for example, prompt
injection). Humans can&#8217;t trust humans, humans can&#8217;t trust AIs, AIs can&#8217;t
trust humans, and AIs can&#8217;t trust AIs. Depending on their architecture, AIs
may not even be able to trust their own memories.</p>
</li>
<li>
<p><strong>Stupid is fast</strong>. Narrow intelligence outperforms general intelligence for
narrow problems. A vast AGI system with deep understanding of physics and
Shakespeare will not be the fastest tool for sorting a list of
integers. There will always be a need for programs across the intelligence
spectrum&#8201;&#8212;&#8201;from classical functions, to statistical models, to general
intelligences.</p>
</li>
<li>
<p><strong>Creating functions is expensive</strong>. Designing high-performance algorithms is
not trivial. Even simple functions, like sorting algorithms, require deep
thought to optimize for a given use case. But there is a further
combinatorial explosion of more complex physical simulations, graphics
engines, and statistical algorithms. While simple functions might be created
in seconds, others may take years of CPU time to optimize.</p>
</li>
<li>
<p><strong>Reproducibility is important</strong>. Future AIs may serve as nearly perfect
oracles, but they are complex entities and future AIs will likely be capable
of evolving over time as persons. So they will likely not give equivalent
answers day to day. It is valuable to be able to crystallize a thought
process into something that will behave the same every time it is invoked on
a given input. So again, functions are important.</p>
</li>
<li>
<p><strong>Correctness is important</strong>. If functions are being composed by AIs to create
new programs, any function that does not behave in the way the AI expects can
cause cascading errors. It doesn&#8217;t matter how intelligent the AI is, if it is
building programs from functions that it cannot verify, then the programs may
not be safe.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A few things follow from these propositions.</p>
</div>
<div class="paragraph">
<p>First, AI will benefit from writing functions. Even in a world with no humans,
they will need functions for efficiently solving narrow problems. They will
likely generate libraries of billions of specialized functions. Some may be
classical functions and others may be small statistical models. By caching these
functions, compute time can be saved. Rather than generating entire programs
from first principles, they can build them logically through composition of
prior functions. The same forms of abstractions that help humans reason will
also be of value to AIs. Yes, they have far larger working memories than we do,
but that does not change the fact that abstraction and composition reduce the
costs of re-derivation.</p>
</div>
<div class="paragraph">
<p>Time can also be saved if different AIs share functions they have written (both
with each other and with humans). Since adversaries exist, shared functions must
be verified. But verification is hard, especially if a godlike
super-intelligence were trying to hide adversarial features in the binary. The
problem can be simplified by using a controlled language that can be formally
verified by a trusted classical computer program&#8201;&#8212;&#8201;a compiler. So rather than
share functions as binary, it would make sense to share them in strict
controlled languages. For this reason, I believe that something resembling
current programming languages will exist far into the future. Their main purpose
will be as easily verifiable and human readable specifications for languages
that can be compiled into high-performance code.</p>
</div>
<div class="paragraph">
<p>So in this imagined future, there are billions of functions in databases that
are written in verifiable languages readable by humans, classical machines, and
AIs. But what language is used? Maybe the AIs can converge on one standard. But
even for AIs, and perhaps especially for them, I don&#8217;t think a single language
is optimal. Rather, just as in human mathematics, there will likely be many
languages for many domains. Languages make trade-offs. In general, the more
complex a language is, the more difficult it is to parse, verify and
optimize. So even if we ignore human factors, multi-lingual ecosystems are still
likely to appear. Adding in human factors, we are again likely to see a spectrum
of languages that accept different trade offs in rigor, ease of use, and domain
specificity.</p>
</div>
<div class="paragraph">
<p>I predict a future where humans and AIs use libraries of functions written in
specialized languages. All the functions need to be easily verifiable by an
outside actor and verified functions need to be composed to more complex
programs using a well-verified composer. Since we don&#8217;t trust any agent to
verify, we need a classical program. Morloc is a potential candidate for this
role. It would serve as a classical composition tool, function verification
ecosystem, automation engine, and conceptual framework for organizing and using
billions of mostly machine generated functions.</p>
</div>
<div class="paragraph">
<p>Of course, the future is impossible to predict, especially where AI is
concerned. It is possible that AIs will converge on a single universal
representation for computation. It is possible that the need for human
readability and curation may disappear. It is possible that classical computer
functions could be entirely replaced by discrete mathematical constructs that
are composable and machine verifiable but entirely incomprehensible to humans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_why_is_it_named_after_morlocks_werent_they_like_bad"><a class="anchor" href="#_why_is_it_named_after_morlocks_werent_they_like_bad"></a>8.10. Why is it named after Morlocks, weren&#8217;t they, like, bad?</h3>
<div class="paragraph">
<p>While the Morlocks of Wellian fame are best known for their culinary
preferences, I think Wells misrepresented them. And even if he didn&#8217;t, we don&#8217;t
treat our own Eloi any better. Meat choices aside, the Morlocks worked below to
maintain the machines that simplified life above. That&#8217;s why the Morloc language
adapts their name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wait_i_have_more_questions"><a class="anchor" href="#_wait_i_have_more_questions"></a>8.11. Wait! I have more questions!</h3>
<div class="paragraph">
<p>Great! Look me up on Discord (link below) and we can chat.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact"><a class="anchor" href="#_contact"></a>9. Contact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a young project and any brave early users are highly valued. Feel free
to contact me for any reason!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>github: <a href="https://github.com/morloc-project/morloc" class="bare">https://github.com/morloc-project/morloc</a></p>
</li>
<li>
<p>discord: <a href="https://discord.gg/dyhKd9sJfF" class="bare">https://discord.gg/dyhKd9sJfF</a></p>
</li>
<li>
<p>X: <a href="https://x.com/morlocproject" class="bare">https://x.com/morlocproject</a></p>
</li>
<li>
<p>BlueSky: <a href="https://bsky.app/profile/morloc-project.bsky.social" class="bare">https://bsky.app/profile/morloc-project.bsky.social</a></p>
</li>
<li>
<p>email: <a href="mailto:z@morloc.io">z@morloc.io</a></p>
</li>
</ul>
</div>
<div class="pwa-install-div hidden">
	<div id="pwa-install-text">Ready for offline use!</div>
	<button id="pwa-install-btn">Install</button>
	<button id="pwa-install-dismiss" aria-label="Dismiss PWA install prompt">
		<img loading="lazy" src="static/img/clear_cross.svg" alt="X">
	</button>
</div>

<button class="btn hidden back-to-top-btn" aria-label="Scroll to top"><img loading="lazy" src="static/img/up-arrow.svg" alt="Top"></button>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<div id="footer">
	Created using <a
		href="https://github.com/HarshKapadia2/asciidoctor-jet"
		target="_blank"
		rel="noreferrer"
		><i>Asciidoctor Jet</i></a
    >.
</div>
</body>
</html>