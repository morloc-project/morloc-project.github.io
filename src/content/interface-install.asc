=== Search and install

The docstrings are used for discoverability as well. In this section I'll cover
how modules are installed as executables or standard modules and how they can be
searched.

I'll demonstrate this with a simple two module Morloc program describing a set
of DnD operations. The first module defines general random operations:

[source,python]
.fate.loc
----
module fate (roll, coinToss, choose)

import root-py

source Py from "fate.py"
  ( "roll" as roll
  , "coin_toss" as coinToss  
  , "choose" as choose
  )

--' Roll n d-sided dice
roll :: 
  --' Number of dice
  Int ->
  --' Number of pips per die
  Int ->
  --' Roll values
  {[Int]}

--' Randomly return True or False
coinToss :: {Bool}

--' Randomly choose one element from a non-empty list
choose a :: [a] -> {a}
----

The second module applies these random functions to 

.combat.loc
[source,morloc]
----
module dnd (rollAdv, knightDamage, randomClass, randomRace)

import root-py
import fate (roll, coinToss, choose) 

--' Roll a pair of d20 dice and keep the larger result
rollAdv :: {Int}
rollAdv = {fold max 0 !(roll 2 20)}

--' Damage done on hit, modifier + sum of dice rolls
damage :: Int -> {[Int]} -> {Int}
damage modifier attackDice = {modifier + sum !attackDice}

--' A knights damage
knightDamage :: Int -> {Int}
knightDamage modifier = damage modifier (roll 2 10)

--' Select a random class
randomClass :: {Str}
randomClass = choose ["Fighter", "Wizard", "Rogue", "Cleric", "Ranger", "Bard"]

--' Select a random race
randomRace :: {Str}
randomRace = choose ["Human", "Elf", "Dwarf", "Halfling"]
----

We can build just the CLI tools if we wish: 

[source,bash]
----
$ morloc make dnd.loc
----

This will build the executable `dnd` which is a script that carries with it all
the information needed for execution. You can copy it anywhere you like on the
system and it will work (so long as the contents of the directory where it was
made are preserved). If you want, you can move the executable to a location in
your system PATH and then you can call it as a normal program from anywhere.

But Morloc offers a cleaner solution:

[source,bash]
----
$ morloc make --install dnd.loc
----

This command does several things.

First it installs the `dnd` exeuctable to a standard path. The `pool/` artifacts
and all files in the current working directory need to be moved to a starndard
location. There are two ways you can specify the required build files.

You can specify required files with `--include` arguments

[source,bash]
----
$ morloc make --install dnd.loc --include fate.loc --include fate.py
----

Or you can create a `package.yaml` file and add an `include` field. The default
file can be generaed for you with `morloc new`. You can then modify the
`include` field list with the required files:

[source,yaml]
----
name: dnd
version: 0.1.0
homepage: null
synopsis: null
description: null
category: null
license: MIT
author: null
maintainer: null
github: null
bug-reports: null
dependencies: []
# Files to include when installing with `morloc make --install`
include: ["fate.*"]
----

Then run `morloc make --install dnd.loc`.

In both install paths, the `dnd` source code is copied to the
`~/.local/share/morloc/exe/<modname>` folder and the executable script itself is
written to `~/.local/share/morloc/bin/`.

We can view the installed executable:

[source,console]
----
$ morloc list -v dnd
Programs:
  dnd  4 commands
    rollAdv :: Int
    knightDamage :: Int
    randomClass :: Str
    randomRace :: Str
----

If we add the Morloc bin folder above to PATH, then we can now use this program naturally:

[source,console]
----
$ dnd -h
Usage: mim <manifest> [OPTION...] COMMAND [ARG...]

Nexus Options:
 -h, --help            Print this help message
 -o, --output-file     Print to this file instead of STDOUT
 -f, --output-format   Output format [json|mpk|voidstar]

Commands (call with -h/--help for more info):
  rollAdv       Roll a pair of d20 dice and keep the larger result
  knightDamage  A knights damage
  randomClass   Select a random class
  randomRace    Select a random race
$ dnd knightDamage 5
21
$ dnd knightDamage 5
14
----

We can also uninstall with `morloc uninstall dnd`. This will cleanly remove the
installed source and the installed executable script.
